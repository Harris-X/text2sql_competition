[    
    {
        "sql_id": "sql_28",
        "question": "统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"",
        "sql": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select '广域战场'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = '广域战场模式'\n        group by vplayerid\n\n        union all\n        select '消灭战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by vplayerid\n\n        union all\n        select '幻想混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='创意创作间' and submodename='幻想混战'\n        group by vplayerid\n\n        union all\n        select '荒野传说', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by vplayerid\n\n        union all\n        select '策略载具', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='休闲模式' and submodename like '%策略载具%'\n        group by vplayerid\n\n        union all\n        select '炎夏混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by vplayerid\n\n        union all\n        select '单人装备', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='组队竞技' and submodename like '%单人装备%'\n        group by vplayerid\n\n        union all\n        select '交叉堡垒', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select '广域战场' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = '广域战场模式'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '消灭战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '幻想混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='创意创作间' and submodename='幻想混战'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '荒野传说', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by dtstatdate, vplayerid\n\n        union all\n        select '策略载具', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='休闲模式' and submodename like '%策略载具%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '炎夏混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '单人装备', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='组队竞技' and submodename like '%单人装备%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '交叉堡垒', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);\n",
        "复杂度": "中等",
        "table_list": [
            "dws_jordass_mode_roundrecord_di"
        ],
        "knowledge": "说明：\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'\n\n第几天留存：0表示当天参与、1表示当天参与在第2天也参与、2表示当天参与在第3天也参与，依此类推",
        "golden_sql": true
    },
    {
        "sql_id": "sql_28_",
        "question": "统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"",
        "sql": "WITH mode_launch_info AS (\n  SELECT vplayerid, dtstatdate, '广域战场' AS mode_name, '20240723' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE submodename = '广域战场模式' AND dtstatdate >= '20240723' AND dtstatdate <= '20240729'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '消灭战' AS mode_name, '20230804' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '组队竞技' AND submodename LIKE '%消灭战模式%' \n    AND dtstatdate >= '20230804' AND dtstatdate <= '20230810'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '幻想混战' AS mode_name, '20241115' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '创意创作间' AND submodename = '幻想混战' \n    AND dtstatdate >= '20241115' AND dtstatdate <= '20241121'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '荒野传说' AS mode_name, '20240903' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '休闲模式' AND submodename IN ('荒野传说', '荒野沙漠') \n    AND dtstatdate >= '20240903' AND dtstatdate <= '20240909'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '策略载具' AS mode_name, '20241010' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '休闲模式' AND submodename LIKE '%策略载具%' \n    AND dtstatdate >= '20241010' AND dtstatdate <= '20241016'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '炎夏混战' AS mode_name, '20240625' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '创意创作间' AND submodename LIKE '%炎夏混战%' \n    AND dtstatdate >= '20240625' AND dtstatdate <= '20240701'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '单人装备' AS mode_name, '20240517' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '组队竞技' AND submodename LIKE '%单人装备%' \n    AND dtstatdate >= '20240517' AND dtstatdate <= '20240523'\n  \n  UNION ALL\n  \n  SELECT vplayerid, dtstatdate, '交叉堡垒' AS mode_name, '20240412' AS launch_date \n  FROM dws_jordass_mode_roundrecord_di \n  WHERE modename = '组队竞技' AND submodename LIKE '%交叉堡垒%' \n    AND dtstatdate >= '20240412' AND dtstatdate <= '20240418'\n),\nplayer_first_participation AS (\n  SELECT vplayerid, mode_name, launch_date, MIN(dtstatdate) AS first_participation_date\n  FROM mode_launch_info\n  GROUP BY vplayerid, mode_name, launch_date\n),\nretention_days_seq AS (\n  SELECT 0 AS retention_day\n  UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 \n  UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7\n),\nplayer_retention_check AS (\n  SELECT \n    pfp.mode_name,\n    pfp.first_participation_date,\n    rds.retention_day,\n    pfp.vplayerid,\n    DATE_ADD(pfp.first_participation_date, INTERVAL rds.retention_day DAY) AS target_date\n  FROM player_first_participation pfp\n  CROSS JOIN retention_days_seq rds\n),\nplayer_with_participation AS (\n  SELECT \n    prc.mode_name,\n    prc.first_participation_date,\n    prc.retention_day,\n    prc.vplayerid\n  FROM player_retention_check prc\n  INNER JOIN mode_launch_info mli \n    ON prc.vplayerid = mli.vplayerid \n    AND prc.mode_name = mli.mode_name\n    AND mli.dtstatdate = prc.target_date\n)\nSELECT \n  mode_name AS playmethod,\n  first_participation_date AS first_play_date,\n  retention_day,\n  COUNT(DISTINCT vplayerid) AS retention_user_count\nFROM player_with_participation\nGROUP BY mode_name, first_participation_date, retention_day\nORDER BY mode_name, first_participation_date, retention_day\n;",
        "复杂度": "中等",
        "table_list": [
            "dws_jordass_mode_roundrecord_di"
        ],
        "knowledge": "说明：\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'\n\n第几天留存：0表示当天参与、1表示当天参与在第2天也参与、2表示当天参与在第3天也参与，依此类推",
        "golden_sql": true
    }
]