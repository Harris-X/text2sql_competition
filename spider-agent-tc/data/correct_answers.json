[
  {
    "sql_id": "sql_1",
    "input": "统计2025.07.24的手游全量用户且标签为其他，在竞品业务下2025.05.30-2025.07.24的在线时长。\n输出：suserid、sgamecode、ionlinetime\n\n",
    "output": "SELECT \n    t1.suserid,\n    t1.sgamecode,\n    SUM(t1.ionlinetime) as ionlinetime\nFROM dws_mgamejp_login_user_activity_di t1\nJOIN dim_vplayerid_vies_df t2 \n    ON t1.suserid = t2.suserid \n    AND t2.dtstatdate = '20250724' \n    AND t2.itag = '其他'\nWHERE t1.dtstatdate BETWEEN 20250530 AND 20250724\n    AND t1.sgamecode IN ('initiatived','jordass','esports','allianceforce','strategy','playzone','su')\n    AND t1.saccounttype = '-100'\n    AND t1.suseridtype IN ('qq','wxid')\n    AND t1.splattype = '-100'\n    AND t1.splat = '-100'\nGROUP BY t1.suserid, t1.sgamecode\nORDER BY t1.suserid, t1.sgamecode;"
  },
  {
    "sql_id": "sql_3",
    "input": "统计2025年1月勇者盟约端游活跃玩家交叉峡谷端游及手游活跃玩家\n输出：玩家gplayerid",
    "output": "SELECT DISTINCT a.iuserid AS gplayerid\nFROM dws_argothek_oss_login_di a\nJOIN dim_argothek_gplayerid2qqwxid_df b ON a.iuserid = b.iuserid\nWHERE a.statis_date BETWEEN 20250101 AND 20250131\nAND b.suserid IN (\n    SELECT DISTINCT suserid\n    FROM dws_mgamejp_login_user_activity_di\n    WHERE sgamecode = 'initiatived'\n    AND saccounttype = '-100'\n    AND suseridtype IN ('qq', 'wxid')\n    AND splattype IN ('-100', 'PC')\n    AND splat = '-100'\n    AND dtstatdate BETWEEN 20250101 AND 20250131\n)\nORDER BY a.iuserid"
  },
  {
    "sql_id": "sql_6",
    "input": "统计2025.6.12-2025.7.14号手游T2活跃用户在20250529之前端游注册的号码包。\n输出：vplayerid",
    "output": "SELECT DISTINCT a.vplayerid\nFROM final_algorithm_competition.dws_argothek_ce1_cbt2_vplayerid_suserid_di a\nJOIN final_algorithm_competition.dim_argothek_gplayerid2qqwxid_df b\nON a.suserid = b.suserid\nWHERE a.dtstatdate BETWEEN '20250612' AND '20250714'\nAND a.itag = 'T2'\nAND b.iregdate < '20250529'"
  },
  {
    "sql_id": "sql_7",
    "input": "统计2025.7.3-2025.7.6 开白渠道非内部体验和买量测试，排除全平台\n注册渠道为以下，分别的新进用户数\n89903934\n89903933\n89903932\n89902725\n89902724\n89902723\n89900960\n89900961\n89900962\n输出：日期（20250703、...、20250706）、注册渠道、新进用户数",
    "output": "SELECT \n    dtstatdate AS 日期,\n    iregway AS 注册渠道,\n    COUNT(*) AS 新进用户数\nFROM dws_argothek_ce1_cbt2_vplayerid_suserid_di \nWHERE dtstatdate BETWEEN '20250703' AND '20250706'\n  AND iregway IN ('89903934', '89903933', '89903932', '89902725', '89902724', '89902723', '89900960', '89900961', '89900962')\n  AND iregdate = dtstatdate\n  AND sourcename = '非内部体验'\nGROUP BY dtstatdate, iregway\nORDER BY dtstatdate, iregway"
  },
  {
    "sql_id": "sql_11",
    "input": "统计近30天活跃玩家数，近30天活跃且同时拥有奖池所有道具玩家数\n输出：近30天活跃玩家数、近30天活跃且同时拥有奖池所有道具玩家数\n补充说明：\n当前日期时间：'20250617'\n其中奖池道具id为：\n71d260ca-4bad-81f2-0298-44860341a7a6\n48601754-442d-98cb-2109-3fb2075500ec\na9126263-439c-7be6-d668-52a6c0c0a36f\n34ecc788-4034-71d2-a0ac-c398b8ecb2ae\n56f98991-43f8-dcc8-189e-08b7ae6c42ad\n8453f8ef-4c0b-46e2-8768-3e9e45c67a2c\n06d90274-435f-3e32-9d57-26bc228ae2e5\n8196dea4-4229-c951-13a9-088fb13b3512\n3abc330f-444a-6dfd-5863-81856ba62624\n041a43a4-46fe-dab7-c974-36bf91eab33d\n5b863cb9-4e41-ec89-69ee-49a223d05ff1\n",
    "output": "WITH active_players AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_useractivity_df\n    WHERE statis_date = 20250617\n    AND iworldid = 255\n    AND RIGHT(iactivity, 30) REGEXP '1'\n),\nplayers_with_all_items AS (\n    SELECT iuserid\n    FROM dwd_argothek_gearrecord_df\n    WHERE dtstatdate = 20250617\n    AND iGoodsId IN (\n        '71d260ca-4bad-81f2-0298-44860341a7a6',\n        '48601754-442d-98cb-2109-3fb2075500ec',\n        'a9126263-439c-7be6-d668-52a6c0c0a36f',\n        '34ecc788-4034-71d2-a0ac-c398b8ecb2ae',\n        '56f98991-43f8-dcc8-189e-08b7ae6c42ad',\n        '8453f8ef-4c0b-46e2-8768-3e9e45c67a2c',\n        '06d90274-435f-3e32-9d57-26bc228ae2e5',\n        '8196dea4-4229-c951-13a9-088fb13b3512',\n        '3abc330f-444a-6dfd-5863-81856ba62624',\n        '041a43a4-46fe-dab7-c974-36bf91eab33d',\n        '5b863cb9-4e41-ec89-69ee-49a223d05ff1'\n    )\n    GROUP BY iuserid\n    HAVING COUNT(DISTINCT iGoodsId) = 11\n)\nSELECT \n    (SELECT COUNT(*) FROM active_players) AS active_players_30_days,\n    (SELECT COUNT(*) FROM active_players ap INNER JOIN players_with_all_items pwai ON ap.iuserid = pwai.iuserid) AS active_players_with_all_items"
  },
  {
    "sql_id": "sql_14",
    "input": "统计2025年5月份活跃但2025年6月未活跃的qq号码包\n输出:用户suserid",
    "output": "WITH may_active AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date >= 20250501 AND statis_date <= 20250531\n),\njune_active AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date >= 20250601 AND statis_date <= 20250630\n)\nSELECT DISTINCT dim.suserid\nFROM may_active ma\nLEFT JOIN june_active ja ON ma.iuserid = ja.iuserid\nJOIN dim_argothek_gplayerid2qqwxid_df dim ON ma.iuserid = dim.iuserid\nWHERE ja.iuserid IS NULL\nAND dim.dtstatdate = '20250610'\nAND dim.swxid_type = 'qq'\nORDER BY dim.suserid"
  },
  {
    "sql_id": "sql_15",
    "input": "统计2025年5月勇者盟约流失用户中，流向峡谷PC的玩家gplayerid\n输出：玩家gplayerid",
    "output": "SELECT DISTINCT churned.iuserid AS gplayerid\nFROM (\n    SELECT iuserid\n    FROM dws_argothek_oss_useractivity_df \n    WHERE statis_date = 20250531\n    AND INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),1,31),'1') = 0 \n    AND INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),32,31),'1') > 0\n) churned\nWHERE EXISTS (\n    SELECT 1\n    FROM dim_argothek_gplayerid2qqwxid_df a\n    JOIN dws_mgamejp_login_user_activity_di p ON a.suserid = p.suserid\n    WHERE a.iuserid = churned.iuserid\n    AND a.dtstatdate = '20250608'\n    AND p.sgamecode = 'initiatived'\n    AND p.saccounttype = '-100'\n    AND p.suseridtype IN ('qq','wxid')\n    AND p.splattype IN ('-100','PC')\n    AND p.splat = '-100'\n    AND p.dtstatdate BETWEEN 20250501 AND 20250531\n    AND p.itimes >= 1\n)"
  },
  {
    "sql_id": "sql_18",
    "input": "统计20250506-20250512期间每日的指定网吧渠道内每个渠道活跃人数\n输出：日期（20250506、...、20250512）、渠道、玩家数\n其中：网吧渠道：iloginway in (1,10,11,12,35,20,28,29,30,31,32,33,34,36)",
    "output": "SELECT \n    statis_date AS 日期,\n    iloginway AS 渠道,\n    COUNT(DISTINCT iuserid) AS 玩家数\nFROM dws_argothek_oss_login_di\nWHERE statis_date BETWEEN 20250506 AND 20250512\nAND iloginway IN (1,10,11,12,35,20,28,29,30,31,32,33,34,36)\nGROUP BY statis_date, iloginway\nORDER BY statis_date, iloginway"
  },
  {
    "sql_id": "sql_23",
    "input": "统计2025年3月24日至2025年3月30日，至少完成过一场对局，且渠道登录的用户qq\n输出:qq",
    "output": "SELECT DISTINCT qq_dim.suserid as qq\nFROM dws_argothek_oss_login_di login\nJOIN dim_argothek_gplayerid2qqwxid_df qq_dim \n  ON login.iuserid = qq_dim.iuserid \nWHERE login.statis_date BETWEEN 20250324 AND 20250330\n  AND login.iloginway = 3\n  AND qq_dim.swxid_type = 'qq'\n  AND qq_dim.dtstatdate = '20250330'\n  AND EXISTS (\n    SELECT 1\n    FROM dwd_argothek_playermatchstats_hi matches\n    WHERE matches.vroleid = qq_dim.vRoleID\n      AND DATE(matches.dteventtime) BETWEEN '2025-03-24' AND '2025-03-30'\n  )\nORDER BY qq_dim.suserid"
  },
  {
    "sql_id": "sql_27",
    "input": "统计：2024-01-01到2024-12-16，购买阶段出现了x次武器代买，除自定义模式、新手、训练场外所有模式。\n输出：武器代买次数",
    "output": "SELECT COUNT(*) AS weapon_daibuy_count\nFROM final_algorithm_competition.dwd_argothek_apinventorymovementlog_hi inv\nJOIN final_algorithm_competition.dwd_argothek_matchdetails_hi match\nON inv.matchinfomatchid = match.matchid\nWHERE inv.tdbank_imp_date BETWEEN '2024010100' AND '2024121623'\nAND match.tdbank_imp_date BETWEEN '2024010100' AND '2024121623'\nAND inv.transactiontype = 'FulfillRequest'\nAND match.provisioningflowid = 'Matchmaking'"
  },
  {
    "sql_id": "sql_31",
    "input": "统计20250217-20250318协作平台活跃但是没有在协作玩法活跃用户的主玩玩法分布\n输出：主玩玩法（传统模式、休闲模式、...、生存模式）、人数",
    "output": "WITH collab_platform_users AS (\n    -- Users active on collaboration platform\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_buttonpress_pre_di \n    WHERE dtstatdate BETWEEN '20250217' AND '20250318'\n),\ncollab_gameplay_users AS (\n    -- Users active in collaboration gameplay\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di \n    WHERE dtstatdate BETWEEN '20250217' AND '20250318' \n    AND vtemp1 = '协作'\n),\ntarget_users AS (\n    -- Users active on collaboration platform but not in collaboration gameplay\n    SELECT cpu.vplayerid\n    FROM collab_platform_users cpu\n    LEFT JOIN collab_gameplay_users cgu ON cpu.vplayerid = cgu.vplayerid\n    WHERE cgu.vplayerid IS NULL\n),\nuser_mode_time AS (\n    -- Calculate total play time per user per mode\n    SELECT \n        vplayerid, \n        modename, \n        SUM(roundtime) as total_time\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20250217' AND '20250318'\n    AND modename IN ('传统模式','休闲模式','组队竞技','领地','乐园','广阔天地','创意创作间','生存模式')\n    GROUP BY vplayerid, modename\n),\nuser_main_mode AS (\n    -- Rank modes by time for each user and select the top one\n    SELECT \n        vplayerid,\n        modename,\n        ROW_NUMBER() OVER (PARTITION BY vplayerid ORDER BY total_time DESC) as rn\n    FROM user_mode_time\n)\n-- Count users by their main play mode\nSELECT \n    modename as 主玩玩法,\n    COUNT(*) as 人数\nFROM user_main_mode umm\nJOIN target_users tu ON umm.vplayerid = tu.vplayerid\nWHERE rn = 1\nGROUP BY modename\nORDER BY 人数 DESC;"
  },
  {
    "sql_id": "sql_32",
    "input": "统计2023/1/14-2023/1/28\n2024/2/2-2024/2/16\n2025/1/21-2025/2/4\n每天所有玩法的参与人数，总时长\n输出：日期（20230101、20230102、...、20230128、20240202、...、20250204），参与人数，时长（分钟）",
    "output": "SELECT \n    dtstatdate AS 日期,\n    COUNT(DISTINCT vplayerid) AS 参与人数,\n    SUM(roundtime)/60 AS 时长_分钟\nFROM dws_jordass_mode_roundrecord_di\nWHERE \n    (dtstatdate BETWEEN 20230114 AND 20230128) OR\n    (dtstatdate BETWEEN 20240202 AND 20240216) OR\n    (dtstatdate BETWEEN 20250121 AND 20250204)\nGROUP BY dtstatdate\nORDER BY dtstatdate"
  },
  {
    "sql_id": "sql_42",
    "input": "统计2021.11.1-2021.11.30每天按extarg2中用\"_\"分割的第2位的值包含(8,16,17)看点击情况\n输出：日期，按extarg2中用\"_\"分割的第2位，人数，次数",
    "output": "SELECT \n    dtstatdate AS 日期,\n    SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n              LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1) AS 第二位值,\n    COUNT(DISTINCT vplayerid) AS 人数,\n    COUNT(*) AS 次数\nFROM dws_jordass_buttonpress_pre_di\nWHERE dtstatdate BETWEEN '20211101' AND '20211130'\n  AND SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n                LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1) IN ('8', '16', '17')\nGROUP BY dtstatdate, \n         SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n                   LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1)\nORDER BY dtstatdate, 第二位值"
  },
  {
    "sql_id": "sql_43",
    "input": "统计2025.1.1-2025.1.31期间活跃度分布\n输出：活跃度（轻度、中度、重度）、玩家数\n\n活跃度：轻度1-5天，中度6-15天，重度大于16天",
    "output": "SELECT \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END AS 活跃度,\n    COUNT(*) AS 玩家数\nFROM (\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS active_days\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20250101' AND '20250131'\n    GROUP BY vplayerid\n) player_active_days\nGROUP BY \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END\nORDER BY \n    MIN(active_days)"
  },
  {
    "sql_id": "sql_47",
    "input": "统计2023.07.01-08.31期间，每天微信活跃用户在2023.09.1-09.21期间流失并且是2023.07.01-08.31有付费的用户\n输出：人数",
    "output": "WITH active_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE vgameappid = 'wx' \n    AND dtstatdate BETWEEN '20230701' AND '20230831'\n),\npaid_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_water_di\n    WHERE vgameappid = 'wx'\n    AND dtstatdate BETWEEN '20230701' AND '20230831'\n),\nnot_lost_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE vgameappid = 'wx'\n    AND dtstatdate BETWEEN '20230901' AND '20230921'\n)\nSELECT COUNT(*) as 人数\nFROM active_users a\nJOIN paid_users p ON a.vplayerid = p.vplayerid\nWHERE a.vplayerid NOT IN (SELECT vplayerid FROM not_lost_users)"
  },
  {
    "sql_id": "sql_50",
    "input": "统计2024.10.1-2024.10.31期间点击400211，点击400212，点击400211及400212的重合用户作为用户类型，看不同性别、砺刃活跃度和乐园活跃度情况\n\n输出：用户类型（400211、400212、400211&400212、other），游戏角色性别（male、female、other）、乐园活跃度（light、medium、heavy、other）、砺刃活跃度（light、medium、heavy、other），人数\n\n乐园跟砺刃的活跃度： 轻度1-4天；中度5-15天；重度>=16天",
    "output": "WITH button_users AS (\n  SELECT \n    vplayerid,\n    MAX(CASE WHEN buttontype = '400211' THEN 1 ELSE 0 END) AS clicked_400211,\n    MAX(CASE WHEN buttontype = '400212' THEN 1 ELSE 0 END) AS clicked_400212\n  FROM dws_jordass_buttonpress_pre_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  AND buttontype IN ('400211', '400212')\n  GROUP BY vplayerid\n),\nuser_categories AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN clicked_400211 = 1 AND clicked_400212 = 1 THEN '400211&400212'\n      WHEN clicked_400211 = 1 THEN '400211'\n      WHEN clicked_400212 = 1 THEN '400212'\n      ELSE 'other'\n    END AS user_type\n  FROM button_users\n),\n-- Get latest gender for each user\nlatest_gender AS (\n  SELECT \n    vplayerid,\n    gender,\n    ROW_NUMBER() OVER (PARTITION BY vplayerid ORDER BY dteventtime DESC) as rn\n  FROM dwd_jordass_playerlogin_hi\n  WHERE gender IS NOT NULL\n),\nuser_gender AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN gender = 1 THEN 'male'\n      WHEN gender = 2 THEN 'female'\n      ELSE 'other'\n    END AS game_gender\n  FROM latest_gender\n  WHERE rn = 1\n),\n-- Calculate jordass activity level (login days in Oct 2024)\njordass_activity AS (\n  SELECT \n    vplayerid,\n    COUNT(DISTINCT dtstatdate) as login_days\n  FROM dws_jordass_login_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  GROUP BY vplayerid\n),\njordass_levels AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN login_days >= 16 THEN 'heavy'\n      WHEN login_days >= 5 THEN 'medium'\n      WHEN login_days >= 1 THEN 'light'\n      ELSE 'other'\n    END AS jordass_activity_level\n  FROM jordass_activity\n),\n-- Calculate park activity level (matchlog days in Oct 2024)\npark_activity AS (\n  SELECT \n    vplayerid,\n    COUNT(DISTINCT dtstatdate) as play_days\n  FROM dws_jordass_matchlog_stat_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  GROUP BY vplayerid\n),\npark_levels AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN play_days >= 16 THEN 'heavy'\n      WHEN play_days >= 5 THEN 'medium'\n      WHEN play_days >= 1 THEN 'light'\n      ELSE 'other'\n    END AS park_activity_level\n  FROM park_activity\n)\nSELECT \n  uc.user_type,\n  COALESCE(ug.game_gender, 'other') AS game_gender,\n  COALESCE(pl.park_activity_level, 'other') AS park_activity_level,\n  COALESCE(jl.jordass_activity_level, 'other') AS jordass_activity_level,\n  COUNT(*) AS user_count\nFROM user_categories uc\nLEFT JOIN user_gender ug ON uc.vplayerid = ug.vplayerid\nLEFT JOIN park_levels pl ON uc.vplayerid = pl.vplayerid\nLEFT JOIN jordass_levels jl ON uc.vplayerid = jl.vplayerid\nGROUP BY uc.user_type, ug.game_gender, pl.park_activity_level, jl.jordass_activity_level\nORDER BY uc.user_type, ug.game_gender, pl.park_activity_level, jl.jordass_activity_level"
  },
  {
    "sql_id": "sql_67",
    "input": "统计2025.1.24-2025.2.6时间区间内，道具为430487,430485,602004025,602002011 的产出次数\t\n输出：道具id，产出次数",
    "output": "SELECT \n    igoodsid AS 道具id,\n    COUNT(*) AS 产出次数\nFROM dwd_jordass_gearlog_hi\nWHERE \n    dteventtime >= '2025-01-24 00:00:00' \n    AND dteventtime <= '2025-02-06 23:59:59'\n    AND igoodsid IN (430487, 430485, 602004025, 602002011)\n    AND addorreduce = 0\nGROUP BY igoodsid\nORDER BY igoodsid;"
  },
  {
    "sql_id": "sql_69",
    "input": "统计2024.12.25——2025.1.5 ，不同信息类型的玩家数量\n\n信息类型:chattype in (20,25,26,16,27,8)\n\n输出 日期（20241225-20250105），信息类型，人数，次数",
    "output": "SELECT \n    LEFT(tdbank_imp_date, 8) AS 日期,\n    chattype AS 信息类型,\n    COUNT(DISTINCT playerid) AS 人数,\n    COUNT(*) AS 次数\nFROM dwd_jordass_msgchatrecord_hi\nWHERE \n    LEFT(tdbank_imp_date, 8) BETWEEN '20241225' AND '20250105'\n    AND chattype IN (20,25,26,16,27,8)\nGROUP BY \n    LEFT(tdbank_imp_date, 8), \n    chattype\nORDER BY \n    日期, \n    信息类型"
  },
  {
    "sql_id": "sql_70",
    "input": "统计2024.11.29-2024.12.19期间，不同抽奖档位的对应人数\n输出 抽奖档位（含汇总档位），人数",
    "output": "SELECT \n    CAST(awardidx AS CHAR) AS 抽奖档位,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM dwd_jordass_activity_rewardrecord_hi\nWHERE actid = 2411291018\nAND dteventtime >= '2024-11-29 00:00:00' \nAND dteventtime <= '2024-12-19 23:59:59'\nGROUP BY awardidx\nUNION ALL\nSELECT \n    '汇总' AS 抽奖档位,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM dwd_jordass_activity_rewardrecord_hi\nWHERE actid = 2411291018\nAND dteventtime >= '2024-11-29 00:00:00' \nAND dteventtime <= '2024-12-19 23:59:59'\nORDER BY 抽奖档位;"
  },
  {
    "sql_id": "sql_71",
    "input": "统计2024.11.29-2024.12.19期间，每七天统计一次阶梯活动相关用户数\n输出 日期范围（20241129-20241205、20241206-20241212、20241213-20241219），extarg1类型，用户数，次数",
    "output": "SELECT \n    CASE \n        WHEN DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-05' THEN '20241129-20241205'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-06' AND '2024-12-12' THEN '20241206-20241212'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-13' AND '2024-12-19' THEN '20241213-20241219'\n    END AS date_range,\n    extarg1 AS extarg1_type,\n    COUNT(DISTINCT vplayerid) AS user_count,\n    COUNT(*) AS occurrence_count\nFROM dwd_jordass_activitypress_hi\nWHERE \n    DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-19'\n    AND ireason = 2411291018 \n    AND buttontype = 10045 \n    AND extarg1 IN (101, 109, 110)\nGROUP BY \n    CASE \n        WHEN DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-05' THEN '20241129-20241205'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-06' AND '2024-12-12' THEN '20241206-20241212'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-13' AND '2024-12-19' THEN '20241213-20241219'\n    END,\n    extarg1\nORDER BY \n    date_range,\n    extarg1_type;"
  },
  {
    "sql_id": "sql_73",
    "input": "统计20241123-20241222对决冠军，乐园其他，和乐园汇总 三类用户的组队和对局情况\n输出：乐园总参与人数，乐园总参与局数，乐园组队人数，乐园组队局数，对决冠军总参与人数，对决冠军总参与局数，对决冠军组队人数，对决冠军组队局数，乐园其他总参与人数，乐园其他总参与局数，乐园其他组队人数，乐园其他组队局数",
    "output": "SELECT \n    -- 乐园汇总 (matchmode=1003)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchresult = 'ok' THEN vplayerid END) AS 乐园总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchresult = 'ok' THEN 1 END) AS 乐园总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 乐园组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 乐园组队局数,\n    \n    -- 对决冠军 (matchmode=1003 and matchsubmodegroup=1345785623905087744)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' THEN vplayerid END) AS 对决冠军总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' THEN 1 END) AS 对决冠军总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 对决冠军组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 对决冠军组队局数,\n    \n    -- 乐园其他 (matchmode=1003 and matchsubmodegroup<>1345785623905087744)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' THEN vplayerid END) AS 乐园其他总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' THEN 1 END) AS 乐园其他总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 乐园其他组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 乐园其他组队局数\nFROM dwd_jordass_player_matchrecord_hi\nWHERE tdbank_imp_date BETWEEN 20241123 AND 20241222;"
  },
  {
    "sql_id": "sql_74",
    "input": "统计 SS30赛季手册和SS29赛季手册的按钮人数\nSS30赛季:2024112305 - 2024112616\nSS29赛季:2024092405 - 2024092716\n输出：按钮类型，SS30赛季手册人数，SS29赛季手册人数",
    "output": "SELECT \n    buttontype as '按钮类型',\n    ss30_count as 'SS30赛季手册人数',\n    ss29_count as 'SS29赛季手册人数'\nFROM (\n    SELECT \n        '411130' as buttontype,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024112305' AND '2024112616' AND buttontypes LIKE '%411130%' THEN vplayerid END) as ss30_count,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024092405' AND '2024092716' AND buttontypes LIKE '%411130%' THEN vplayerid END) as ss29_count\n    FROM dwd_jordass_pressbutton_hi\n    WHERE (tdbank_imp_date BETWEEN '2024112305' AND '2024112616' OR tdbank_imp_date BETWEEN '2024092405' AND '2024092716')\n        AND buttontypes LIKE '%411130%'\n    UNION ALL\n    SELECT \n        '411200' as buttontype,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024112305' AND '2024112616' AND buttontypes LIKE '%411200%' THEN vplayerid END) as ss30_count,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024092405' AND '2024092716' AND buttontypes LIKE '%411200%' THEN vplayerid END) as ss29_count\n    FROM dwd_jordass_pressbutton_hi\n    WHERE (tdbank_imp_date BETWEEN '2024112305' AND '2024112616' OR tdbank_imp_date BETWEEN '2024092405' AND '2024092716')\n        AND buttontypes LIKE '%411200%'\n) result"
  },
  {
    "sql_id": "sql_75",
    "input": "统计：2022080400-2024112400的研究所解锁语音数量\n输出：baseid,解锁语音数量",
    "output": "SELECT \n    baseid,\n    COUNT(*) AS 解锁语音数量\nFROM \n    dwd_jordass_voicethemelog_hi\nWHERE \n    baseid IN (3336008, 3304024, 3336012, 3306028, 3304030, 3336016, 3336018, 3304038, 3336023, 3306033, 3349004, 3308014, 3336032, 3304043, 3306039, 3336041, 3301024, 3336045, 3306042)\n    AND dteventtime >= '2022-08-04 00:00:00'\n    AND dteventtime <= '2024-11-24 00:00:00'\nGROUP BY \n    baseid\nORDER BY \n    baseid;"
  },
  {
    "sql_id": "sql_78",
    "input": "统计：首日红装活动（20250119）返场抽奖的用户属性\n输出：初日华服回归抽奖&沙漠统治者有抽奖人数\n初日华服回归抽奖&境界双花有抽奖人数\t\t\n初日华服回归抽奖&玄龙凌霄有抽奖人数\t\t\n初日华服回归抽奖&沙漠统治者有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&境界双花有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&玄龙凌霄有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&【沙漠统治者和境界双花有主套】人数\t\t\n初日华服回归抽奖&【沙漠统治者和玄龙凌霄有主套】人数\t\t\t\t\n初日华服回归抽奖&【境界双花和玄龙凌霄有主套】人数\t\t\t\t\n初日华服回归抽奖但【沙漠统治者&境界双花&玄龙凌霄】没有抽奖人数",
    "output": "WITH first_day_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date LIKE '20250119%' AND activitytype = 815\n),\ndesert_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 690 AND tdbank_imp_date BETWEEN '20240426' AND '20240606'\n),\nrealm_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 748 AND tdbank_imp_date BETWEEN '20240607' AND '20240725'\n),\ndragon_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 750 AND tdbank_imp_date BETWEEN '20240726' AND '20240822'\n),\ndesert_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430179 AND addorreduce = 0\n),\nrealm_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430265 AND addorreduce = 0\n),\ndragon_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430225 AND addorreduce = 0\n)\nSELECT \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_draw_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&沙漠统治者有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_draw_users r ON f.vplayerid = r.vplayerid) AS '初日华服回归抽奖&境界双花有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN dragon_draw_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&玄龙凌霄有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN desert_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&沙漠统治者有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_draw_users r ON f.vplayerid = r.vplayerid\n     LEFT JOIN realm_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&境界双花有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN dragon_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN dragon_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&玄龙凌霄有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_owner_users d ON f.vplayerid = d.vplayerid\n     INNER JOIN realm_owner_users r ON f.vplayerid = r.vplayerid) AS '初日华服回归抽奖&【沙漠统治者和境界双花有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_owner_users d ON f.vplayerid = d.vplayerid\n     INNER JOIN dragon_owner_users dr ON f.vplayerid = dr.vplayerid) AS '初日华服回归抽奖&【沙漠统治者和玄龙凌霄有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_owner_users r ON f.vplayerid = r.vplayerid\n     INNER JOIN dragon_owner_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&【境界双花和玄龙凌霄有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     LEFT JOIN desert_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN realm_draw_users r ON f.vplayerid = r.vplayerid\n     LEFT JOIN dragon_draw_users dr ON f.vplayerid = dr.vplayerid\n     WHERE d.vplayerid IS NULL AND r.vplayerid IS NULL AND dr.vplayerid IS NULL) AS '初日华服回归抽奖但【沙漠统治者&境界双花&玄龙凌霄】没有抽奖人数'"
  },
  {
    "sql_id": "sql_83",
    "input": "统计流失14天以上的回流用户的点击量子鸟赠礼、回到大厅和参与乐园对局的数据\n统计日期\n2024/1/2\n2023/12/19\n2023/12/12\n2023/12/5\n2023/10/10\n2023/9/19\n2023/1/3\n2022/12/20\n输出：统计日（YYYYMMDD）、用户类型（'流失14天以上的回流用户'）、当天回流用户数、点击量子鸟赠礼用户数、回到大厅用户数、当天有参与乐园对局的用户数",
    "output": "WITH returning_users AS (\n  SELECT \n    dtstatdate,\n    vplayerid\n  FROM dws_jordass_login_df\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n    AND SUBSTRING(cbitmap, 1, 1) = '1'  -- Logged in on stat date\n    AND SUBSTRING(cbitmap, 2, 14) = REPEAT('0', 14)  -- No login for 14 days before\n    AND (LENGTH(cbitmap) > 15 OR (LENGTH(cbitmap) = 15 AND SUBSTRING(cbitmap, 15, 1) = '1'))\n),\nbutton_press_summary AS (\n  SELECT \n    dtstatdate,\n    vplayerid,\n    MAX(CASE WHEN buttontype = '10370' THEN 1 ELSE 0 END) AS quantum_bird_gift_click,\n    MAX(CASE WHEN buttontype IN ('10373', '10374') THEN 1 ELSE 0 END) AS return_to_lobby_click\n  FROM dws_jordass_buttonpress_pre_di\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n    AND buttontype IN ('10370', '10373', '10374')\n  GROUP BY dtstatdate, vplayerid\n),\npark_match_summary AS (\n  SELECT \n    dtstatdate,\n    vplayerid,\n    COUNT(*) AS park_match_count\n  FROM dws_jordass_matchlog_stat_di\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n  GROUP BY dtstatdate, vplayerid\n)\nSELECT \n  r.dtstatdate AS 统计日,\n  '流失14天以上的回流用户' AS 用户类型,\n  COUNT(r.vplayerid) AS 当天回流用户数,\n  COUNT(CASE WHEN b.quantum_bird_gift_click = 1 THEN 1 END) AS 点击量子鸟赠礼用户数,\n  COUNT(CASE WHEN b.return_to_lobby_click = 1 THEN 1 END) AS 回到大厅用户数,\n  COUNT(CASE WHEN p.park_match_count > 0 THEN 1 END) AS 当天有参与乐园对局的用户数\nFROM returning_users r\nLEFT JOIN button_press_summary b ON r.dtstatdate = b.dtstatdate AND r.vplayerid = b.vplayerid\nLEFT JOIN park_match_summary p ON r.dtstatdate = p.dtstatdate AND r.vplayerid = p.vplayerid\nGROUP BY r.dtstatdate\nORDER BY r.dtstatdate;"
  },
  {
    "sql_id": "sql_97",
    "input": "在2023.7.19-2023.7.25时间范围内，分别统计参与了隐匿的用户人数、既参与隐匿也参与了桥梁争夺的用户、既参与隐匿也参与了隐匿模式的用户\n输出：参与了隐匿的不重复的人的个数、参与隐匿并且参与了桥梁争夺的不重复的人的个数、参与隐匿并且参与了隐匿模式的不重复的人的个数\n",
    "output": "SELECT \n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS participated_in_stealth,\n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL AND bridge_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS stealth_and_bridge,\n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL AND stealth_mode_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS stealth_and_stealth_mode\nFROM (\n    -- Users who participated in 隐匿 (imode = 1307095884553538304 and platid <> 255)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND imode = 1307095884553538304\n    AND platid <> 255\n) AS stealth_users\nLEFT JOIN (\n    -- Users who participated in 桥梁争夺 (imode = 1310822585431254784 and platid <> 255)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND imode = 1310822585431254784\n    AND platid <> 255\n) AS bridge_users ON stealth_users.vplayerid = bridge_users.vplayerid\nLEFT JOIN (\n    -- Users who participated in 隐匿模式 (mode = 2370)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND mode = 2370\n) AS stealth_mode_users ON stealth_users.vplayerid = stealth_mode_users.vplayerid;"
  },
  {
    "sql_id": "sql_107",
    "input": "统计2022.1.18-1.24与2021.10.19-12.20这两个时间段\n buttontype =99123并且 ireason=3的人数，以及两个时间段都满足条件的交叉人数\n输出：2022.1.18-1.24人数，2021.10.19-12.20人数，两个时间段交叉的人数",
    "output": "SELECT \n    COUNT(DISTINCT CASE WHEN dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59' THEN vplayerid END) AS period1_count,\n    COUNT(DISTINCT CASE WHEN dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59' THEN vplayerid END) AS period2_count,\n    (SELECT COUNT(*) FROM (\n        SELECT vplayerid\n        FROM dwd_jordass_activitypress_hi\n        WHERE buttontype = 99123 AND ireason = 3\n        AND dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59'\n        INTERSECT\n        SELECT vplayerid\n        FROM dwd_jordass_activitypress_hi\n        WHERE buttontype = 99123 AND ireason = 3\n        AND dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59'\n    ) AS intersect_users) AS intersection_count\nFROM dwd_jordass_activitypress_hi\nWHERE buttontype = 99123 AND ireason = 3\nAND (\n    (dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59') OR\n    (dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59')\n);"
  }
]