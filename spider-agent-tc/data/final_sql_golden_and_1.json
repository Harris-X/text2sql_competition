[
  {
    "sql_id": "sql_1",
    "question": "统计2025.07.24的手游全量用户且标签为其他，在竞品业务下2025.05.30-2025.07.24的在线时长。\n输出：suserid、sgamecode、ionlinetime\n\n",
    "复杂度": "中等",
    "table_list": [
      "dws_mgamejp_login_user_activity_di",
      "dim_vplayerid_vies_df"
    ],
    "knowledge": "竞品业务：\nsgamecode in (\"initiatived\",\"jordass\",\"esports\",\"allianceforce\",\"strategy\",\"playzone\",\"su\")\nsaccounttype = \"-100\" -- 账号体系，取-100表示汇总\nand suseridtype in (\"qq\",\"wxid\") -- 用户类型\nand splattype = \"-100\" -- 平台类型\nand splat = \"-100\" -- 平台，写死为-100\n",
    "sql": "SELECT \n    t1.suserid,\n    t1.sgamecode,\n    SUM(t1.ionlinetime) as ionlinetime\nFROM dws_mgamejp_login_user_activity_di t1\nJOIN dim_vplayerid_vies_df t2 \n    ON t1.suserid = t2.suserid \n    AND t2.dtstatdate = '20250724' \n    AND t2.itag = '其他'\nWHERE t1.dtstatdate BETWEEN 20250530 AND 20250724\n    AND t1.sgamecode IN ('initiatived','jordass','esports','allianceforce','strategy','playzone','su')\n    AND t1.saccounttype = '-100'\n    AND t1.suseridtype IN ('qq','wxid')\n    AND t1.splattype = '-100'\n    AND t1.splat = '-100'\nGROUP BY t1.suserid, t1.sgamecode\nORDER BY t1.suserid, t1.sgamecode;"
  },
  {
    "sql_id": "sql_3",
    "question": "统计2025年1月勇者盟约端游活跃玩家交叉峡谷端游及手游活跃玩家\n输出：玩家gplayerid",
    "复杂度": "简单",
    "table_list": [
      "dws_argothek_oss_login_di",
      "dim_argothek_gplayerid2qqwxid_df",
      "dws_mgamejp_login_user_activity_di"
    ],
    "knowledge": "峡谷筛选逻辑:\nsgamecode = \"initiatived\" -- 筛选峡谷游戏\nand saccounttype = \"-100\" -- 账号体系，取-100表示汇总\nand suseridtype in (\"qq\", \"wxid\") -- 账号类型，取qq或wxid\nand splattype in (\"-100\", \"PC\") -- 峡谷手游玩家及PC端玩家\nand splat = \"-100\" -- 写死为-100",
    "sql": "SELECT DISTINCT a.iuserid AS gplayerid\nFROM dws_argothek_oss_login_di a\nJOIN dim_argothek_gplayerid2qqwxid_df b ON a.iuserid = b.iuserid\nWHERE a.statis_date BETWEEN 20250101 AND 20250131\nAND b.suserid IN (\n    SELECT DISTINCT suserid\n    FROM dws_mgamejp_login_user_activity_di\n    WHERE sgamecode = 'initiatived'\n    AND saccounttype = '-100'\n    AND suseridtype IN ('qq', 'wxid')\n    AND splattype IN ('-100', 'PC')\n    AND splat = '-100'\n    AND dtstatdate BETWEEN 20250101 AND 20250131\n)\nORDER BY a.iuserid"
  },
  {
    "sql_id": "sql_6",
    "question": "统计2025.6.12-2025.7.14号手游T2活跃用户在20250529之前端游注册的号码包。\n输出：vplayerid",
    "复杂度": "简单",
    "table_list": [
      "dim_argothek_gplayerid2qqwxid_df",
      "dws_argothek_ce1_cbt2_vplayerid_suserid_di"
    ],
    "knowledge": "用户活跃用户筛选条件：\nitag=\"T2\"",
    "sql": "SELECT DISTINCT a.vplayerid\nFROM final_algorithm_competition.dws_argothek_ce1_cbt2_vplayerid_suserid_di a\nJOIN final_algorithm_competition.dim_argothek_gplayerid2qqwxid_df b\nON a.suserid = b.suserid\nWHERE a.dtstatdate BETWEEN '20250612' AND '20250714'\nAND a.itag = 'T2'\nAND b.iregdate < '20250529'"
  },
  {
    "sql_id": "sql_7",
    "question": "统计2025.7.3-2025.7.6 开白渠道非内部体验和买量测试，排除全平台\n注册渠道为以下，分别的新进用户数\n89903934\n89903933\n89903932\n89902725\n89902724\n89902723\n89900960\n89900961\n89900962\n输出：日期（20250703、...、20250706）、注册渠道、新进用户数",
    "复杂度": "中等",
    "table_list": [
      "dws_argothek_ce1_cbt2_vplayerid_suserid_di",
      "dwd_argothek_cbt2kaibai_hi"
    ],
    "knowledge": "非内部体验和买量测试：通过sourcename区分\n指定注册渠道:\niregway in (\"89903934\", \"89903933\", \"89903932\", \"89902725\", \"89902724\", \"89902723\", \"89900960\", \"89900961\", \"89900962\")",
    "sql": "SELECT \n    dtstatdate AS 日期,\n    iregway AS 注册渠道,\n    COUNT(*) AS 新进用户数\nFROM dws_argothek_ce1_cbt2_vplayerid_suserid_di \nWHERE dtstatdate BETWEEN '20250703' AND '20250706'\n  AND iregway IN ('89903934', '89903933', '89903932', '89902725', '89902724', '89902723', '89900960', '89900961', '89900962')\n  AND iregdate = dtstatdate\n  AND sourcename = '非内部体验'\nGROUP BY dtstatdate, iregway\nORDER BY dtstatdate, iregway"
  },
  {
    "sql_id": "sql_11",
    "question": "统计近30天活跃玩家数，近30天活跃且同时拥有奖池所有道具玩家数\n输出：近30天活跃玩家数、近30天活跃且同时拥有奖池所有道具玩家数\n补充说明：\n当前日期时间：'20250617'\n其中奖池道具id为：\n71d260ca-4bad-81f2-0298-44860341a7a6\n48601754-442d-98cb-2109-3fb2075500ec\na9126263-439c-7be6-d668-52a6c0c0a36f\n34ecc788-4034-71d2-a0ac-c398b8ecb2ae\n56f98991-43f8-dcc8-189e-08b7ae6c42ad\n8453f8ef-4c0b-46e2-8768-3e9e45c67a2c\n06d90274-435f-3e32-9d57-26bc228ae2e5\n8196dea4-4229-c951-13a9-088fb13b3512\n3abc330f-444a-6dfd-5863-81856ba62624\n041a43a4-46fe-dab7-c974-36bf91eab33d\n5b863cb9-4e41-ec89-69ee-49a223d05ff1\n",
    "复杂度": "中等",
    "table_list": [
      "dwd_argothek_gearrecord_df",
      "dws_argothek_oss_useractivity_df"
    ],
    "knowledge": "这张表的iworldid = 255代表玩家粒度， 奖池道具筛选逻辑：\niGoodsId in (\n\"71d260ca-4bad-81f2-0298-44860341a7a6\",\n\"48601754-442d-98cb-2109-3fb2075500ec\",\n\"a9126263-439c-7be6-d668-52a6c0c0a36f\",\n\"34ecc788-4034-71d2-a0ac-c398b8ecb2ae\",\n\"56f98991-43f8-dcc8-189e-08b7ae6c42ad\",\n\"8453f8ef-4c0b-46e2-8768-3e9e45c67a2c\",\n\"06d90274-435f-3e32-9d57-26bc228ae2e5\",\n\"8196dea4-4229-c951-13a9-088fb13b3512\",\n\"3abc330f-444a-6dfd-5863-81856ba62624\",\n\"041a43a4-46fe-dab7-c974-36bf91eab33d\",\n\"5b863cb9-4e41-ec89-69ee-49a223d05ff1\"",
    "sql": "WITH active_players AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_useractivity_df\n    WHERE statis_date = 20250617\n    AND iworldid = 255\n    AND RIGHT(iactivity, 30) REGEXP '1'\n),\nplayers_with_all_items AS (\n    SELECT iuserid\n    FROM dwd_argothek_gearrecord_df\n    WHERE dtstatdate = 20250617\n    AND iGoodsId IN (\n        '71d260ca-4bad-81f2-0298-44860341a7a6',\n        '48601754-442d-98cb-2109-3fb2075500ec',\n        'a9126263-439c-7be6-d668-52a6c0c0a36f',\n        '34ecc788-4034-71d2-a0ac-c398b8ecb2ae',\n        '56f98991-43f8-dcc8-189e-08b7ae6c42ad',\n        '8453f8ef-4c0b-46e2-8768-3e9e45c67a2c',\n        '06d90274-435f-3e32-9d57-26bc228ae2e5',\n        '8196dea4-4229-c951-13a9-088fb13b3512',\n        '3abc330f-444a-6dfd-5863-81856ba62624',\n        '041a43a4-46fe-dab7-c974-36bf91eab33d',\n        '5b863cb9-4e41-ec89-69ee-49a223d05ff1'\n    )\n    GROUP BY iuserid\n    HAVING COUNT(DISTINCT iGoodsId) = 11\n)\nSELECT \n    (SELECT COUNT(*) FROM active_players) AS active_players_30_days,\n    (SELECT COUNT(*) FROM active_players ap INNER JOIN players_with_all_items pwai ON ap.iuserid = pwai.iuserid) AS active_players_with_all_items"
  },
  {
    "sql_id": "sql_14",
    "question": "统计2025年5月份活跃但2025年6月未活跃的qq号码包\n输出:用户suserid",
    "复杂度": "中等",
    "table_list": [
      "dws_argothek_oss_login_di",
      "dim_argothek_gplayerid2qqwxid_df"
    ],
    "knowledge": "限定dim_argothek_gplayerid2qqwxid_df的日期为\"20250610\"",
    "sql": "WITH may_active AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date >= 20250501 AND statis_date <= 20250531\n),\njune_active AS (\n    SELECT DISTINCT iuserid\n    FROM dws_argothek_oss_login_di\n    WHERE statis_date >= 20250601 AND statis_date <= 20250630\n)\nSELECT DISTINCT dim.suserid\nFROM may_active ma\nLEFT JOIN june_active ja ON ma.iuserid = ja.iuserid\nJOIN dim_argothek_gplayerid2qqwxid_df dim ON ma.iuserid = dim.iuserid\nWHERE ja.iuserid IS NULL\nAND dim.dtstatdate = '20250610'\nAND dim.swxid_type = 'qq'\nORDER BY dim.suserid"
  },
  {
    "sql_id": "sql_15",
    "question": "统计2025年5月勇者盟约流失用户中，流向峡谷PC的玩家gplayerid\n输出：玩家gplayerid",
    "复杂度": "中等",
    "table_list": [
      "dws_argothek_oss_useractivity_df",
      "dim_argothek_gplayerid2qqwxid_df",
      "dws_mgamejp_login_user_activity_di"
    ],
    "knowledge": "sgamecode = \"initiatived\" -- 筛选峡谷游戏\nand itimes >= 1 -- 活跃用户条件\nand saccounttype = \"-100\" -- 账号体系，取-100表示汇总\nand suseridtype in (\"qq\", \"wxid\") -- 账号类型，取qq或wxid\nand splattype = \"PC\" -- 峡谷端游玩家\nand splat = \"-100\" -- 写死为-100\n5月流失：限定INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),1,31),'1') = 0 AND INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),32,31),'1') > 0\n取20250608的数据做账号转换",
    "sql": "SELECT DISTINCT churned.iuserid AS gplayerid\nFROM (\n    SELECT iuserid\n    FROM dws_argothek_oss_useractivity_df \n    WHERE statis_date = 20250531\n    AND INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),1,31),'1') = 0 \n    AND INSTR(SUBSTR(REVERSE(RPAD(iactivity,128,'0')),32,31),'1') > 0\n) churned\nWHERE EXISTS (\n    SELECT 1\n    FROM dim_argothek_gplayerid2qqwxid_df a\n    JOIN dws_mgamejp_login_user_activity_di p ON a.suserid = p.suserid\n    WHERE a.iuserid = churned.iuserid\n    AND a.dtstatdate = '20250608'\n    AND p.sgamecode = 'initiatived'\n    AND p.saccounttype = '-100'\n    AND p.suseridtype IN ('qq','wxid')\n    AND p.splattype IN ('-100','PC')\n    AND p.splat = '-100'\n    AND p.dtstatdate BETWEEN 20250501 AND 20250531\n    AND p.itimes >= 1\n)"
  },
  {
    "sql_id": "sql_18",
    "question": "统计20250506-20250512期间每日的指定网吧渠道内每个渠道活跃人数\n输出：日期（20250506、...、20250512）、渠道、玩家数\n其中：网吧渠道：iloginway in (1,10,11,12,35,20,28,29,30,31,32,33,34,36)",
    "复杂度": "简单",
    "table_list": [
      "dws_argothek_oss_login_di"
    ],
    "knowledge": "",
    "sql": "SELECT \n    statis_date AS 日期,\n    iloginway AS 渠道,\n    COUNT(DISTINCT iuserid) AS 玩家数\nFROM dws_argothek_oss_login_di\nWHERE statis_date BETWEEN 20250506 AND 20250512\nAND iloginway IN (1,10,11,12,35,20,28,29,30,31,32,33,34,36)\nGROUP BY statis_date, iloginway\nORDER BY statis_date, iloginway"
  },
  {
    "sql_id": "sql_23",
    "question": "统计2025年3月24日至2025年3月30日，至少完成过一场对局，且渠道登录的用户qq\n输出:qq",
    "复杂度": "中等",
    "table_list": [
      "dws_argothek_oss_login_di",
      "dim_argothek_gplayerid2qqwxid_df",
      "dwd_argothek_playermatchstats_hi",
      "dim_argothek_gplayerid_vroleid_df"
    ],
    "knowledge": "渠道筛选条件：iloginway = 3\n用户ID筛选swxid_type = \"qq\" -- 筛选swxid_type为\"qq\"",
    "sql": "SELECT DISTINCT qq_dim.suserid as qq\nFROM dws_argothek_oss_login_di login\nJOIN dim_argothek_gplayerid2qqwxid_df qq_dim \n  ON login.iuserid = qq_dim.iuserid \nWHERE login.statis_date BETWEEN 20250324 AND 20250330\n  AND login.iloginway = 3\n  AND qq_dim.swxid_type = 'qq'\n  AND qq_dim.dtstatdate = '20250330'\n  AND EXISTS (\n    SELECT 1\n    FROM dwd_argothek_playermatchstats_hi matches\n    WHERE matches.vroleid = qq_dim.vRoleID\n      AND DATE(matches.dteventtime) BETWEEN '2025-03-24' AND '2025-03-30'\n  )\nORDER BY qq_dim.suserid"
  },
  {
    "sql_id": "sql_27",
    "question": "统计：2024-01-01到2024-12-16，购买阶段出现了x次武器代买，除自定义模式、新手、训练场外所有模式。\n输出：武器代买次数",
    "复杂度": "中等",
    "table_list": [
      "dwd_argothek_matchdetails_hi",
      "dwd_argothek_apinventorymovementlog_hi"
    ],
    "knowledge": "provisioningflowid = \"Matchmaking\" -- 除自定义模式、新手、训练场外所有模式\n\n对局代买筛选逻辑：\nTransactionType = \"FulfillRequest\"",
    "sql": "SELECT COUNT(*) AS weapon_daibuy_count\nFROM final_algorithm_competition.dwd_argothek_apinventorymovementlog_hi inv\nJOIN final_algorithm_competition.dwd_argothek_matchdetails_hi match\nON inv.matchinfomatchid = match.matchid\nWHERE inv.tdbank_imp_date BETWEEN '2024010100' AND '2024121623'\nAND match.tdbank_imp_date BETWEEN '2024010100' AND '2024121623'\nAND inv.transactiontype = 'FulfillRequest'\nAND match.provisioningflowid = 'Matchmaking'"
  },
  {
    "sql_id": "sql_28",
    "question": "统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"",
    "sql": "select  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select '广域战场'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = '广域战场模式'\n        group by vplayerid\n\n        union all\n        select '消灭战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by vplayerid\n\n        union all\n        select '幻想混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='创意创作间' and submodename='幻想混战'\n        group by vplayerid\n\n        union all\n        select '荒野传说', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by vplayerid\n\n        union all\n        select '策略载具', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='休闲模式' and submodename like '%策略载具%'\n        group by vplayerid\n\n        union all\n        select '炎夏混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by vplayerid\n\n        union all\n        select '单人装备', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='组队竞技' and submodename like '%单人装备%'\n        group by vplayerid\n\n        union all\n        select '交叉堡垒', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select '广域战场' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = '广域战场模式'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '消灭战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '幻想混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='创意创作间' and submodename='幻想混战'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '荒野传说', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by dtstatdate, vplayerid\n\n        union all\n        select '策略载具', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='休闲模式' and submodename like '%策略载具%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '炎夏混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '单人装备', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='组队竞技' and submodename like '%单人装备%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '交叉堡垒', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);\n",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "说明：\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'\n\n第几天留存：0表示当天参与、1表示当天参与在第2天也参与、2表示当天参与在第3天也参与，依此类推",
    "golden_sql": true
  },
  {
    "sql_id": "sql_30",
    "question": "统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数",
    "sql": "with main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end\n\n   union all\n   \n   select substr (tdbank_imp_date, 1, 6) mons,\n        '隧道' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;",
    "复杂度": "复杂",
    "table_list": [
      "dwd_jordass_playerexitgamerecord_hi",
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "主玩定义：用户累计对局时长最多的玩法；\n\n玩法：从dws_jordass_mode_roundrecord_di取\n从上往下匹配，如果满足以下任一条件，则返回对应的名称，否则返回“其他模式”。\n如果模式为“传统模式”，且子模式名称以“CG”开头，且地图为“群屿”，则返回“主题群屿”；\n如果模式为“传统模式”且地图为“群屿”，则返回“传统群屿”；\n如果模式为“传统模式”且地图为“假日群岛”，则返回“假日群岛”；\n如果模式为“传统模式”且地图为“荣耀之城”，则返回“荣耀之城”；\n如果子模式是“广域战场模式”，则返回“广域战场”；\n如果子模式是“极能形态模式”，则返回“极能形态”；\n如果模式是“组队竞技”，则返回“组竞”；\n如果模式是“休闲模式”，则返回“休闲”；\n如果模式是“乐园”，则返回“乐园”；\n如果模式是“领地”，则返回“领地”；\n如果模式是“广阔天地”，则返回“广阔天地”\n\n注意，参与隧道模式的用户数据从dwd_jordass_playerexitgamerecord_hi取，时间限制 2024.6.18-2025.3.30，mode in (3001, 3002, 3003)",
    "golden_sql": true
  },
  {
    "sql_id": "sql_31",
    "question": "统计20250217-20250318协作平台活跃但是没有在协作玩法活跃用户的主玩玩法分布\n输出：主玩玩法（传统模式、休闲模式、...、生存模式）、人数",
    "复杂度": "复杂",
    "table_list": [
      "dws_jordass_matchlog_stat_di",
      "dwd_jordass_buttonpress_pre_di",
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "主玩定义：用户累计对局时长最多的玩法；\n玩法取 modename in ('传统模式','休闲模式','组队竞技','领地','乐园','广阔天地','创意创作间','生存模式')\n协作平台活跃：ugcmbuttonclick中的玩家；\n协作玩法活跃：vtemp1='协作'  的玩法记录",
    "sql": "WITH collab_platform_users AS (\n    -- Users active on collaboration platform\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_buttonpress_pre_di \n    WHERE dtstatdate BETWEEN '20250217' AND '20250318'\n),\ncollab_gameplay_users AS (\n    -- Users active in collaboration gameplay\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di \n    WHERE dtstatdate BETWEEN '20250217' AND '20250318' \n    AND vtemp1 = '协作'\n),\ntarget_users AS (\n    -- Users active on collaboration platform but not in collaboration gameplay\n    SELECT cpu.vplayerid\n    FROM collab_platform_users cpu\n    LEFT JOIN collab_gameplay_users cgu ON cpu.vplayerid = cgu.vplayerid\n    WHERE cgu.vplayerid IS NULL\n),\nuser_mode_time AS (\n    -- Calculate total play time per user per mode\n    SELECT \n        vplayerid, \n        modename, \n        SUM(roundtime) as total_time\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20250217' AND '20250318'\n    AND modename IN ('传统模式','休闲模式','组队竞技','领地','乐园','广阔天地','创意创作间','生存模式')\n    GROUP BY vplayerid, modename\n),\nuser_main_mode AS (\n    -- Rank modes by time for each user and select the top one\n    SELECT \n        vplayerid,\n        modename,\n        ROW_NUMBER() OVER (PARTITION BY vplayerid ORDER BY total_time DESC) as rn\n    FROM user_mode_time\n)\n-- Count users by their main play mode\nSELECT \n    modename as 主玩玩法,\n    COUNT(*) as 人数\nFROM user_main_mode umm\nJOIN target_users tu ON umm.vplayerid = tu.vplayerid\nWHERE rn = 1\nGROUP BY modename\nORDER BY 人数 DESC;"
  },
  {
    "sql_id": "sql_32",
    "question": "统计2023/1/14-2023/1/28\n2024/2/2-2024/2/16\n2025/1/21-2025/2/4\n每天所有玩法的参与人数，总时长\n输出：日期（20230101、20230102、...、20230128、20240202、...、20250204），参与人数，时长（分钟）",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "",
    "sql": "SELECT \n    dtstatdate AS 日期,\n    COUNT(DISTINCT vplayerid) AS 参与人数,\n    SUM(roundtime)/60 AS 时长_分钟\nFROM dws_jordass_mode_roundrecord_di\nWHERE \n    (dtstatdate BETWEEN 20230114 AND 20230128) OR\n    (dtstatdate BETWEEN 20240202 AND 20240216) OR\n    (dtstatdate BETWEEN 20250121 AND 20250204)\nGROUP BY dtstatdate\nORDER BY dtstatdate"
  },
  {
    "sql_id": "sql_33",
    "question": "统计2024年12月14日-2024年12月20日参与建筑争夺玩法的玩家人数（去重）有多少，其中多少人是12月13日及以前有参与过建筑争夺的老玩家，有多少是新玩家\n输出: 玩家人数、老玩家人数、新玩家人数",
    "sql": "select\n    count(distinct a.vplayerid) as total_players,\n    count(distinct case when b.vplayerid is not null then a.vplayerid end) as existing_players,\n    count(distinct case when b.vplayerid is null then a.vplayerid end) as new_players\nfrom (\n    select vplayerid\n    from dws_jordass_matchlog_stat_di\n    where dtstatdate between '20241214' and '20241220'\n    and imode = 1344338933661592832\n    and platid = 255\n    group by vplayerid\n) a\nleft join (\n    select vplayerid\n    from dws_jordass_playermatchrecord_stat_df\n    where dtstatdate = '20241213'\n    and imode = 1344338933661592832\n    and platid = 255\n    group by vplayerid\n) b\non a.vplayerid = b.vplayerid\n;",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_playermatchrecord_stat_df",
      "dws_jordass_matchlog_stat_di"
    ],
    "knowledge": "建筑争夺玩法对应的imode为1344338933661592832",
    "golden_sql": true
  },
  {
    "sql_id": "sql_34",
    "question": "统计2024.9.17-2024.9.23 和 2024.10.8-2024.10.14    每天点击按钮后加入玩法，再之后点击确认的人数，以及这些人加入玩法的次数                                                       \n输出：日期(20240917、...、20240923、20241008、...、20241014)，人数，人次",
    "sql": "select\n    ds,\n    count(distinct vplayerid) as user_cnt,\n    count(distinct vplayerid, irank) as user_times\nfrom (\n    select\n        s2.ds,\n        s2.vplayerid,\n        s2.irank\n    from (\n        -- 获取411111事件（点击按钮）\n        select\n            dtstatdate as ds,\n            vplayerid,\n            dteventtime\n        from dws_jordass_buttonpress_pre_di\n        where buttontype = 411111\n        and  ((dtstatdate between '20240917' and '20240923') or (dtstatdate between '20241008' and '20241014'))\n    ) s1\n    join (\n        -- 获取411120事件（加入玩法）并编号\n        select\n            dtstatdate as ds,\n            vplayerid,\n            dteventtime,\n            row_number() over (partition by vplayerid order by dteventtime) as irank\n        from dws_jordass_buttonpress_pre_di\n        where buttontype = 411120\n        and ((dtstatdate between '20240917' and '20240923') or (dtstatdate between '20241008' and '20241014'))\n    ) s2 on s1.vplayerid = s2.vplayerid and s1.ds = s2.ds and s2.dteventtime > s1.dteventtime\n    join (\n        -- 获取411123事件（确认动作）\n        select\n            dtstatdate as ds,\n            vplayerid,\n            dteventtime\n        from dws_jordass_buttonpress_pre_di\n        where buttontype = 411123\n        and ((dtstatdate between '20240917' and '20240923') or (dtstatdate between '20241008' and '20241014'))\n    ) s3 on s2.vplayerid = s3.vplayerid and s2.ds = s3.ds and s3.dteventtime > s2.dteventtime\n)f \ngroup by ds\n;",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_buttonpress_pre_di"
    ],
    "knowledge": "buttontype为411111代表点击按钮，411120代表加入玩法，411123代表确认",
    "golden_sql": true
  },
  {
    "sql_id": "sql_35",
    "question": "统计2024年3月26日~4月3日\n2024年5月28日~6月5日\n不同对局类型的游戏和玩法留存情况\n输出：统计日期(20240326、...、20240403、20240528、...、20240605)、对局类型（第一人称、单排、双排、四排），每日对局人数、次数、对局总时长(秒)、游戏次留人数、游戏7留人数，玩法次留人数、玩法7留人数",
    "sql": "with round_user as (\n    select dtstatdate,\n        case \n            when mode in (401,402,403) then '第一人称'\n            when mode =101 then '单排'\n            when mode =102 then '双排'\n            when mode in (103,603) then '四排'\n        end modename,\n        vplayerid,\n        sum(roundcnt) roundcnt,\n        sum(roundtime) roundtime\n    from dws_jordass_mode_roundrecord_di\n    where ((dtstatdate between '20240326' and '20240409')\n    or (dtstatdate between '20240528' and '20240611'))\n    and mode in (401,402,403,101,102,103,603)\n    group by dtstatdate,\n    case when mode in (401,402,403) then '第一人称'\n        when mode =101 then '单排'\n        when mode =102 then '双排'\n        when mode in (103,603) then '四排'\n    end,\n    vplayerid\n)\n\nselect \n    a.dtstatdate,\n    a.modename,\n    count(distinct a.vplayerid) iusernum,\n    sum(a.roundcnt) roundcnt,\n    sum(a.roundtime) roundtime,\n    count(distinct b1.vplayerid) stay2,\n    count(distinct b2.vplayerid) stay7,\n    count(distinct c1.vplayerid) playstay2,\n    count(distinct c2.vplayerid) playstay7\nfrom (\n    select * from round_user \n    where((dtstatdate between '20240326' and '20240403') or (dtstatdate between '20240528' and '20240605'))\n) a\nleft join (\n    select dtstatdate,vplayerid \n    from dws_jordass_login_di\n    where ((dtstatdate between '20240326' and '20240404') or (dtstatdate between '20240528' and '20240606')) \n    and platid =255\n    group by dtstatdate,vplayerid\n) b1 \non a.vplayerid = b1.vplayerid and date_add(a.dtstatdate,1) = b1.dtstatdate\nleft join (\n    select dtstatdate,vplayerid \n    from dws_jordass_login_di\n    where ((dtstatdate between '20240326' and '20240409') or (dtstatdate between '20240528' and '20240611')) and platid =255\n    group by dtstatdate,vplayerid\n) b2 \non a.vplayerid = b2.vplayerid and date_add(a.dtstatdate,6) = b2.dtstatdate\nleft join round_user c1 \non a.vplayerid = c1.vplayerid and date_add(a.dtstatdate,1) = c1.dtstatdate and a.modename= c1.modename\nleft join round_user c2 \non a.vplayerid = c2.vplayerid and date_add(a.dtstatdate,6) = c2.dtstatdate and a.modename= c2.modename\ngroup by a.dtstatdate,a.modename\n;",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_login_di",
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "第一人称：mode 的取值在 401、402 或 403；\n单排： mode 等于 101；\n双排： mode 等于 102；\n四排： mode 等于 103 或 603。\n\n玩法次留：当天参与玩法且第二天同样参与玩法\n游戏次留：当天在游戏活跃且第2天也在游戏活跃",
    "golden_sql": true
  },
  {
    "sql_id": "sql_37",
    "question": "统计注册日期在2025.4.1-2025.5.30的模拟器新进用户在用户类型（模拟器、手机端、整体砺刃游戏内），次留、三留、七留、14留、30留情况\n输出:日期(20250401、...、20250530)、人数、用户类型（模拟器、手机端、游戏内、未知）、次留人数、三留人数、七留人数、14留人数、30留人数",
    "sql": "select \n    s1.ds as `ds`, -- 日期\n    count(distinct s1.vplayerid) as `user_cnt`, -- 人数\n    coalesce(user_type, '未知') as `user_type`, -- 用户类型\n    count(distinct case when s2.ds = date_add(s1.ds, 1) then s1.vplayerid else null end) as `next_day_retention`, -- 次留人数\n    count(distinct case when s2.ds = date_add(s1.ds, 2) then s1.vplayerid else null end) as `three_day_retention`, -- 三留人数\n    count(distinct case when s2.ds = date_add(s1.ds, 6) then s1.vplayerid else null end) as `seven_day_retention`, -- 七留人数\n    count(distinct case when s2.ds = date_add(s1.ds, 13) then s1.vplayerid else null end) as `fourteen_day_retention`, -- 14留人数\n    count(distinct case when s2.ds = date_add(s1.ds, 29) then s1.vplayerid else null end) as `thirty_day_retention` -- 30留人数\nfrom (\n    select \n        f1.dregdate as ds,  -- 日期\n        f1.vplayerid as vplayerid  -- 用户id\n    from  dws_jordass_emulator_df f1\n    where   f1.dtstatdate = '20251001'  \n        and f1.dregdate >= '20250401'  \n        and f1.dregdate <= '20250530'  \n        and f1.platid = 255  \n) s1\nleft join (\n    select \n        f1.dtstatdate as ds, -- 统计日期\n        f1.vplayerid as vplayerid, -- 手机端登录用户id\n        '手机端' as user_type\n    from  dws_jordass_device_login_di f1\n    where  f1.device_type=0 -- 手机端\n    and f1.dtstatdate >= '20250401' and f1.dtstatdate <= date_add('20250530', 29)\n\n    union all\n\n    select \n        f1.dtstatdate as ds, -- 统计日期\n        f1.vplayerid as vplayerid, -- 手机端登录用户id\n        '模拟器' as user_type\n    from  dws_jordass_device_login_di f1\n    where  f1.device_type in (1,5) -- 模拟器\n    and f1.dtstatdate >= '20250401' and f1.dtstatdate <= date_add('20250530', 29)\n\n    union all\n\n    select \n        f1.dtstatdate as ds,  -- 日期\n        f1.vplayerid as vplayerid,  -- 整体游戏内登录用户id\n        '游戏内' as user_type\n    from   dws_jordass_login_di f1  \n    where  f1.dtstatdate >= '20250401' and f1.dtstatdate <= date_add('20250530', 29)\n    and f1.platid = 255  -- 不区分系统平台\n) s2 \n    on   s1.vplayerid = s2.vplayerid\n    group by   s1.ds, user_type\n;",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_device_login_di",
      "dws_jordass_emulator_df",
      "dws_jordass_login_di"
    ],
    "knowledge": "模拟器新进用户从dws_jordass_emulator_df取，限制统计日期为20251001\n模拟器：device_type in (1,5)；\n手机端：device_type=0\n",
    "golden_sql": true
  },
  {
    "sql_id": "sql_38",
    "question": "统计不同玩法不同用户类型的参与情况\n\n输出：玩法、用户类型（砺刃新增、砺刃回流（流失60天以上）、砺刃回流（流失21-59天）、砺刃回流（流失14-20天）、砺刃回流（流失7-13天）、砺刃留存、平台盘内、平台盘外）、上线后3天参与用户数、上线后3天总用户数\n\n各玩法上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"",
    "sql": "with usertype as (\n    select '广域战场' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20240723',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '消灭战' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20230804',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '幻想混战' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20241115',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '荒野传说' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20240903',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '策略载具' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20241010',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '炎夏混战' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20240625',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '单人装备' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20240517',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n    union all\n    select '交叉堡垒' itype, dtstatdate, dregdate, vplayerid, cbitmap \n    from dws_jordass_login_df\n    where dtstatdate = date_add('20240412',2) and platid =255 and instr(substr(cbitmap,1,3),'1')>0\n),\ndapan as (\n    select '广域战场' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate >= cast(date_format(date_sub('20240723',7), '%Y%m%d') as bigint) and dtstatdate <= cast(date_format(date_sub('20240723',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '消灭战' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate >= cast(date_format(date_sub('20230804',7), '%Y%m%d') as bigint) and dtstatdate <= cast(date_format(date_sub('20230804',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '幻想混战' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20241115',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20241115',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '荒野传说' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20240903',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20240903',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '策略载具' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20241010',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20241010',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '炎夏混战' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20240625',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20240625',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '单人装备' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20240517',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20240517',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n    union all\n    select '交叉堡垒' itype, suserid, max(case when sgamecode='jordass' then 1 else 0 end) flag1\n    from dws_mgamejp_login_user_activity_di\n    where dtstatdate between cast(date_format(date_sub('20240412',7), '%Y%m%d') as bigint) and cast(date_format(date_sub('20240412',1), '%Y%m%d') as bigint)\n        and saccounttype ='-100'\n        and sgamecode <>'-100'\n        and splattype = '-100'\n        and splat = '-100'\n    group by suserid\n),\ndapan2jordass as (\n    select distinct itype, b.vplayerid, flag1\n    from dapan a\n    join (\n        select vplayerid,suserid from dim_jordass_playerid2suserid_nf\n    ) b on a.suserid = b.suserid\n),\nplayuser as (\n    select '广域战场' itype, min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',2) and submodename= '广域战场模式'\n    group by vplayerid\n    union all\n    select '消灭战' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',2) and modename='组队竞技' and submodename like '%消灭战模式%'\n    group by vplayerid\n    union all\n    select '幻想混战' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',2) and modename='创意创作间' and submodename='幻想混战'\n    group by vplayerid\n    union all\n    select '荒野传说' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',2) and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n    group by vplayerid\n    union all\n    select '策略载具' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',2) and modename='休闲模式' and submodename like '%策略载具%'\n    group by vplayerid\n    union all\n    select '炎夏混战' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',2) and modename='创意创作间' and submodename like '%炎夏混战%'\n    group by vplayerid\n    union all\n    select '单人装备' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',2) and modename='组队竞技' and submodename like '%单人装备%'\n    group by vplayerid\n    union all\n    select '交叉堡垒' itype,min(dtstatdate) dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',2) and modename='组队竞技' and submodename like '%交叉堡垒%'\n    group by vplayerid\n)\n\nselect \n    t.itype,\n    t.user_type,\n    t.iusernum1,\n    p.iusernum2\nfrom (\n    select \n        a.itype,\n        b.user_type,\n        count(distinct a.vplayerid) iusernum1\n    from playuser a\n    join (\n        select \n            itype, vplayerid,\n            case \n                when datediff(dtstatdate,dregdate)<=2 then '砺刃新增'\n                when instr(substr(cbitmap,4),'1')=0 or instr(substr(cbitmap,4),'1')>=60 then '砺刃回流（流失60天以上）'\n                when instr(substr(cbitmap,4),'1')>=21 then '砺刃回流（流失21-59天）'\n                when instr(substr(cbitmap,4),'1')>=14 then '砺刃回流（流失14-20天）'\n                when instr(substr(cbitmap,4),'1')>7 then '砺刃回流（流失7-13天）'\n                when instr(substr(cbitmap,4),'1')<=7 then '砺刃留存' \n            end user_type\n        from usertype\n    ) b on a.itype = b.itype and a.vplayerid = b.vplayerid\n    group by a.itype,b.user_type\n\n    union all\n    \n    select \n        a.itype, \n        case \n            when flag1=0 then '平台盘内' \n            when b.vplayerid is null then '平台盘外' \n        end user_type, \n    count(distinct a.vplayerid) iusernum1\n    from playuser a\n    left join dapan2jordass b \n    on a.itype = b.itype and a.vplayerid = b.vplayerid\n    where flag1=0 or b.vplayerid is null\n    group by a.itype, case when flag1=0 then '平台盘内' when b.vplayerid is null then '平台盘外' end\n) t\nleft join (\n    select itype,\n        case \n            when datediff(dtstatdate,dregdate)<=2 then '砺刃新增'\n            when instr(substr(cbitmap,4),'1')=0 or instr(substr(cbitmap,4),'1')>=60 then '砺刃回流（流失60天以上）'\n            when instr(substr(cbitmap,4),'1')>=21 then '砺刃回流（流失21-59天）'\n            when instr(substr(cbitmap,4),'1')>=14 then '砺刃回流（流失14-20天）'\n            when instr(substr(cbitmap,4),'1')>7 then '砺刃回流（流失7-13天）'\n            when instr(substr(cbitmap,4),'1')<=7 then '砺刃留存' \n        end user_type,\n        count(distinct vplayerid) iusernum2\n    from usertype\n    group by itype,\n        case \n            when datediff(dtstatdate,dregdate)<=2 then '砺刃新增'\n            when instr(substr(cbitmap,4),'1')=0 or instr(substr(cbitmap,4),'1')>=60 then '砺刃回流（流失60天以上）'\n            when instr(substr(cbitmap,4),'1')>=21 then '砺刃回流（流失21-59天）'\n            when instr(substr(cbitmap,4),'1')>=14 then '砺刃回流（流失14-20天）'\n            when instr(substr(cbitmap,4),'1')>7 then '砺刃回流（流失7-13天）'\n            when instr(substr(cbitmap,4),'1')<=7 then '砺刃留存' \n        end\n\n    union all\n\n    select itype,'平台盘内',count(distinct vplayerid) \n    from dapan2jordass \n    group by itype\n) p on t.itype=p.itype and t.user_type=p.user_type\n;",
    "复杂度": "复杂",
    "table_list": [
      "dws_mgamejp_login_user_activity_di",
      "dws_jordass_login_df",
      "dim_jordass_playerid2suserid_nf",
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "从平台大盘表取数据固定逻辑：\nsAccountType ='-100' and sgamecode <>'-100' and splattype = '-100' and splat = '-100'\n\n- 用户类型的定义：\n砺刃新增：上线后3天(包含上线当天)砺刃新增用户，并且参与了玩法的用户\n砺刃留存：上线前一周在砺刃活跃过，并且在上线后3天参与了玩法的用户\n砺刃回流：上线前一周没有在砺刃活跃过，但是之前在砺刃注册过，并且上线后3天参与了玩法的用户，然后按上线日期前N天连续未活跃时长区分：流失(7-13]天，流失[14-20]天，流失[21-59]天，流失60天及以上\n平台盘内：上线前一周在平台大盘活跃过，并且没有在砺刃活跃过，并且上线后3天参与了玩法的用户\n平台盘外：上线前一周没有在平台大盘内活跃过的，并且上线后3天参与了玩法的用户；\n\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'\n\n\n注意：suserid 和 vplayerid是两套用户账号体系；平台大盘代表所有游戏的数据，sgamecode='jordass'代表砺刃使者",
    "golden_sql": true
  },
  {
    "sql_id": "sql_39",
    "question": "\n统计各个玩法参与用户其他玩法流入和双栖情况\n\n输出：流入玩法、流出玩法、上线后3天流入玩法参与用户数、上线后3天流出用户数、上线后3天双栖用户数、上线前一周流出玩法总参与用户数、流出占比、上线后3天流出玩法总参与用户数、双栖占比\n",
    "sql": "with playuser as (\n    select '广域战场' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate= '20240723'  and  date_add('20240723',2) and submodename= '广域战场模式'\n    group by 1,2,3\n    union all\n    select '消灭战' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20230804'  and  date_add('20230804',2) and modename='组队竞技' and submodename like '%消灭战模式%'\n    group by 1,2,3\n    union all\n    select '幻想混战' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20241115' and  date_add('20241115',2) and modename='创意创作间' and submodename='幻想混战'\n    group by 1,2,3\n    union all\n    select '荒野传说' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240903'  and  date_add('20240903',2) and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n    group by 1,2,3\n    union all\n    select '策略载具' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20241010'   and  date_add('20241010',2) and modename='休闲模式' and submodename like '%策略载具%'\n    group by 1,2,3\n    union all\n    select '炎夏混战' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240625'   and  date_add('20240625',2) and modename='创意创作间' and submodename like '%炎夏混战%'\n    group by 1,2,3\n    union all\n    select '单人装备' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240517'   and  date_add('20240517',2) and modename='组队竞技' and submodename like '%单人装备%'\n    group by 1,2,3\n    union all\n    select '交叉堡垒' itype,dtstatdate,vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240412'   and  date_add('20240412',2) and modename='组队竞技' and submodename like '%交叉堡垒%'\n    group by 1,2,3\n    union all\n    select '庆典混战' as itype,dtstatdate,vplayerid\n    from  dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240426'  and  date_add('20240426',2) and submode in (2611)\n    group by dtstatdate,vplayerid\n    union all\n    select 'CG29-流浪地球' as itype,dtstatdate,vplayerid\n    from  dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20240903' and  date_add('20240903',2)and submodename = 'CG29-流浪地球'\n    group by dtstatdate,vplayerid\n    union all\n    select 'CG28-动物丛林' as itype,dtstatdate,vplayerid\n    from  dws_jordass_mode_roundrecord_di\n    where dtstatdate = '20241105' and  date_add('20241105',2)and submodename = 'CG28-动物丛林'\n    group by dtstatdate,vplayerid\n),\nallplayuser as (\n    select '广域战场' itype,\n        case \n            when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n        end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240723' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240723' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240723',7) and dtstatdate <= date_add('20240723',2)  \n    group by \n        case \n            when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n        end ,\n        vplayerid\n    union all\n    select '消灭战' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20230804' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20230804' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20230804',7) and dtstatdate <= date_add('20230804',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '幻想混战' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20241115' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20241115' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20241115',7) and dtstatdate <= date_add('20241115',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '荒野传说' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240903' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240903' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240903',7) and dtstatdate <= date_add('20240903',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '策略载具' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20241010' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20241010' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20241010',7) and dtstatdate <= date_add('20241010',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '炎夏混战' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240625' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240625' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240625',7) and dtstatdate <= date_add('20240625',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '单人装备' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240517' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240517' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240517',7) and dtstatdate <= date_add('20240517',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '交叉堡垒' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240412' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240412' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240412',7) and dtstatdate <= date_add('20240412',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select '庆典混战' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240426' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240426' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240426',7) and dtstatdate <= date_add('20240426',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select 'CG28-动物丛林' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20240903' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20240903' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20240903',7) and dtstatdate <= date_add('20240903',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n    union all\n    select 'CG29-流浪地球' itype,\n        case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end playclass1,\n        vplayerid,\n        max(case when dtstatdate<'20241105' then 1 else 0 end) islast,\n        max(case when dtstatdate>='20241105' then 1 else 0 end) isthis\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= date_sub('20241105',7) and dtstatdate <= date_add('20241105',2)  \n    group by case when modename='传统模式' and submodename like 'CG%' and mapname='群屿' then '主题群屿'\n            when modename='传统模式' and mapname='群屿' then '传统群屿'\n            when modename='传统模式' and mapname='假日群岛' then '假日群岛'\n            when modename='传统模式' and mapname='山峦' then '山峦'\n            when submodename='极能形态模式' then '极能形态模式'\n            when modename='生存模式' then '隧道'\n            when submodename='广域战场模式' then '广域战场'\n            when modename in ('休闲模式','乐园','领地','广阔天地','组队竞技') then modename\n            else '其他子模式'\n            end ,\n        vplayerid\n)\n\nselect  \n    t.itype, \n    t.playclass1, \n    iusernum1, -- 流入玩法参与用户数\n    iusernum2, -- 流出用户数\n    iusernum3, -- 双栖用户数\n    iusernum4, -- 前一周流出玩法用户数\n    coalesce(round(iusernum2/iusernum4, 2), 0) as ratio1, -- 流出占比\n    iusernum5, -- 后3天流出玩法用户数\n    coalesce(round(iusernum3/iusernum5, 2), 0) as ratio2 -- 双栖占比\nfrom (\n    select itype,count(distinct vplayerid) iusernum1 from playuser group by itype\n)p\nleft join (\n    select \n        a.itype,\n        b.playclass1,\n        count(distinct case when islast=1 and isthis =0 then a.vplayerid end) iusernum2,\n        count(distinct case when islast=1 and isthis =1 then a.vplayerid end) iusernum3\n    from playuser a\n    left join allplayuser b \n    on a.itype =b.itype and a.vplayerid = b.vplayerid\n    group by a.itype,b.playclass1\n)t on p.itype = t.itype\nleft join (\n    select \n        itype, \n        playclass1,\n        count(distinct case when islast=1 then vplayerid end) iusernum4,\n        count(distinct case when isthis=1 then vplayerid end) iusernum5\n    from allplayuser\n    group by itype,playclass1\n) m on t.playclass1=m.playclass1 and t.itype=m.itype\n;",
    "复杂度": "复杂",
    "table_list": [
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "\n流入玩法上线日期和取数逻辑：\n广域战场 （2024/7/23）submodename= '广域战场模式'，\n消灭战（2023/8/4） modename='组队竞技' and submodename like '%消灭战模式%'，\n幻想混战（2024/11/15）modename='创意创作间' and submodename='幻想混战'，\n荒野传说（2024-09-03）modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')，\n策略载具（2024-10-10）modename='休闲模式' and submodename like '%策略载具%'，\n炎夏混战（2024-06-25）modename='创意创作间' and submodename like '%炎夏混战%'，\n单人装备（2024.5.17）modename='组队竞技' and submodename like '%单人装备%'，\n交叉堡垒（2024.4.12） modename='组队竞技' and submodename like '%交叉堡垒%'，\n庆典混战（2024/4/26）submode in (2611)，\nCG28战场进化（2024/9/3） modename='传统模式' and submodename ='CG28-动物丛林'，\nCG29流浪地球（2024/11/5） modename='传统模式' and submodename ='CG29-流浪地球'\n\n流出玩法：从上往下匹配，如果满足任一条件则返回对应的玩法名称，否则返回“其他子模式”。\n主题群屿：modename='传统模式' and submodename like 'CG%' and mapname='群屿'\n传统群屿：modename='传统模式' and mapname='群屿'\n假日群岛：modename='传统模式' and mapname='假日群岛'\n山峦：modename='传统模式' and mapname='山峦'\n极能形态模式：submodename='极能形态模式'\n隧道：modename='生存模式'\n广域战场：submodename='广域战场模式'\n休闲模式：modename='休闲模式'\n乐园：modename='乐园'\n领地：modename='领地'\n广阔天地：modename='广阔天地'\n组队竞技：modename='组队竞技'\n\n用户定义：\n流出用户：流入玩法上线前一周玩了流出玩法，并且流入玩法上线后3天没有玩流出玩法，但是有玩流入玩法\n双栖用户：流入玩法上线前一周 和 上线后3天都玩了流出玩法\n流出占比：流出用户除以上线前一周流出玩法总参与\n双栖占比：双栖用户除以上线首周流出玩法总参与",
    "golden_sql": true
  },
  {
    "sql_id": "sql_41",
    "question": "统计2024.1.1～1.3，每天活跃玩家数\n输出：统计日期(20240101、20240102、20240103)、玩家数",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_login_di"
    ],
    "knowledge": "",
    "sql": "SELECT \n    dtstatdate AS 统计日期,\n    COUNT(DISTINCT vplayerid) AS 玩家数\nFROM \n    dws_jordass_login_di\nWHERE \n    dtstatdate BETWEEN 20240101 AND 20240103\nGROUP BY \n    dtstatdate\nORDER BY \n    dtstatdate;"
  },
  {
    "sql_id": "sql_42",
    "question": "统计2021.11.1-2021.11.30每天按extarg2中用\"_\"分割的第2位的值包含(8,16,17)看点击情况\n输出：日期，按extarg2中用\"_\"分割的第2位，人数，次数",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_buttonpress_pre_di"
    ],
    "knowledge": "",
    "sql": "SELECT \n    dtstatdate AS 日期,\n    SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n              LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1) AS 第二位值,\n    COUNT(DISTINCT vplayerid) AS 人数,\n    COUNT(*) AS 次数\nFROM dws_jordass_buttonpress_pre_di\nWHERE dtstatdate BETWEEN '20211101' AND '20211130'\n  AND SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n                LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1) IN ('8', '16', '17')\nGROUP BY dtstatdate, \n         SUBSTRING(extarg2, LOCATE('_', extarg2) + 1, \n                   LOCATE('_', extarg2, LOCATE('_', extarg2) + 1) - LOCATE('_', extarg2) - 1)\nORDER BY dtstatdate, 第二位值"
  },
  {
    "sql_id": "sql_43",
    "question": "统计2025.1.1-2025.1.31期间活跃度分布\n输出：活跃度（轻度、中度、重度）、玩家数\n\n活跃度：轻度1-5天，中度6-15天，重度大于16天",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_login_di"
    ],
    "knowledge": "",
    "sql": "SELECT \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END AS 活跃度,\n    COUNT(*) AS 玩家数\nFROM (\n    SELECT \n        vplayerid,\n        COUNT(DISTINCT dtstatdate) AS active_days\n    FROM dws_jordass_login_di\n    WHERE dtstatdate BETWEEN '20250101' AND '20250131'\n    GROUP BY vplayerid\n) player_active_days\nGROUP BY \n    CASE \n        WHEN active_days BETWEEN 1 AND 5 THEN '轻度'\n        WHEN active_days BETWEEN 6 AND 15 THEN '中度'\n        WHEN active_days >= 16 THEN '重度'\n    END\nORDER BY \n    MIN(active_days)"
  },
  {
    "sql_id": "sql_45",
    "question": "统计2024.01.01-2024.01.07参与乐园子玩法拼图狂欢在2024.01.08-2024.01.14没玩乐园子玩法拼图狂欢在2024.01.15-2024.01.21又玩了乐园子玩法拼图狂欢的用户\n输出：玩家数",
    "sql": "select count(distinct a.vplayerid) as player_num\nfrom (\n    select distinct vplayerid\n    from dws_jordass_matchlog_stat_di\n    where dtstatdate between '20240101' and '20240107'\n    and imode = 1287652322611036928\n) a\nleft join (\n    select distinct vplayerid\n    from dws_jordass_matchlog_stat_di\n    where dtstatdate between '20240108' and '20240114'\n    and imode = 1287652322611036928\n) b on a.vplayerid = b.vplayerid\njoin (\n    select distinct vplayerid\n    from dws_jordass_matchlog_stat_di\n    where dtstatdate between '20240115' and '20240121'\n    and imode = 1287652322611036928\n) c on a.vplayerid = c.vplayerid\nwhere b.vplayerid is null;",
    "复杂度": "简单",
    "table_list": [
      "dws_jordass_matchlog_stat_di"
    ],
    "knowledge": "imode为1287652322611036928代表乐园子玩法拼图狂欢",
    "golden_sql": true
  },
  {
    "sql_id": "sql_46",
    "question": "统计2024.1.1-2024.2.2期间，每个自然周不同周活跃天数玩家数\n输出：统计周(1、2、3...、5)、周活跃天数、玩家数",
    "sql": "select\n    week, -- 统计周\n    active_days, -- 活跃天数\n    count(distinct vplayerid) as user_num -- 玩家数\nfrom (\n    select\n        vplayerid, -- 玩家playerid\n        weekofyear(dtstatdate) as week, -- 统计周\n        count(distinct dtstatdate) as active_days -- 活跃天数\n    from dws_jordass_login_di\n    where dtstatdate >= '20240101' and dtstatdate <= '20240202' and platid=255\n    group by\n        vplayerid,\n        weekofyear(dtstatdate)\n)f\ngroup by\n    week,\n    active_days",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_login_di"
    ],
    "knowledge": "",
    "golden_sql": true
  },
  {
    "sql_id": "sql_47",
    "question": "统计2023.07.01-08.31期间，每天微信活跃用户在2023.09.1-09.21期间流失并且是2023.07.01-08.31有付费的用户\n输出：人数",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_water_di",
      "dws_jordass_login_di"
    ],
    "knowledge": "",
    "sql": "WITH active_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE vgameappid = 'wx' \n    AND dtstatdate BETWEEN '20230701' AND '20230831'\n),\npaid_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_water_di\n    WHERE vgameappid = 'wx'\n    AND dtstatdate BETWEEN '20230701' AND '20230831'\n),\nnot_lost_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_login_di\n    WHERE vgameappid = 'wx'\n    AND dtstatdate BETWEEN '20230901' AND '20230921'\n)\nSELECT COUNT(*) as 人数\nFROM active_users a\nJOIN paid_users p ON a.vplayerid = p.vplayerid\nWHERE a.vplayerid NOT IN (SELECT vplayerid FROM not_lost_users)"
  },
  {
    "sql_id": "sql_48",
    "question": "统计2023.12.1流失7天的回流用户数和流失30天的回流用户数\n输出：流失7天的回流用户数，流失30天的回流用户数",
    "sql": "select\n    count(distinct case when is_backflow_7 then vplayerid end) as backflow_7_user,\n    count(distinct case when is_backflow_30 then vplayerid end) as backflow_30_user\nfrom (\n    select\n        vplayerid,\n        -- 检查是否满足流失7天回流条件\n        (dregdate <> dtstatdate) and\n        (instr(substr(cbitmap, 1, 1), '1') > 0) and\n        (instr(substr(cbitmap, 2, 7), '1') = 0) as is_backflow_7,\n        \n        -- 检查是否满足流失30天回流条件\n        (dregdate <> dtstatdate) and\n        (instr(substr(cbitmap, 1, 1), '1') > 0) and\n        (instr(substr(cbitmap, 2, 30), '1') = 0) as is_backflow_30\n    from\n        dws_jordass_login_df\n    where\n        dtstatdate = '20231201'\n        and platid = 255\n) as user_flags;",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_login_df"
    ],
    "knowledge": "",
    "golden_sql": true
  },
  {
    "sql_id": "sql_49",
    "question": "2024年10月1-2024年10月7 用周期开始时间判断玩法上线时间在7天及以上，周期结束时间判断玩法上线时间在90天及以内的玩法，统计周期内这些玩法的参与和留存情况\n输出：周期(20241001-20241007)，日期(20241001、...、20241007)，参与人数，次留人数",
    "sql": "with play_user as (\n    select distinct\n        p.dtstatdate as ds, --日期\n        p.vplayerid    --玩家id\n    from\n        dws_jordass_matchlog_stat_di p\n    join\n        dim_jordass_submodeonline_nf c\n    on\n        p.imode = c.matchsubmodegroup\n    where\n        p.dtstatdate between '20241001' and '20241008'\n        and datediff('20241001', c.onlinedate) >= 7\n        and datediff('20241007', c.onlinedate) <= 90\n)\nselect\n    '20241001-20241007' as period, --周期\n    a.ds,\n    count(distinct a.vplayerid) as play_user_num, --参与人数\n    count(distinct b.vplayerid) as retention_user_num --次留人数\nfrom\n    play_user a\nleft join\n    play_user b\non\n    a.vplayerid = b.vplayerid\n    and b.ds = date_add(a.ds, 1)  -- 次日留存条件\nwhere\n    a.ds between '20241001' and '20241007'\ngroup by\n    a.ds\norder by\n    a.ds;",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_matchlog_stat_di",
      "dim_jordass_submodeonline_nf"
    ],
    "knowledge": "",
    "golden_sql": true
  },
  {
    "sql_id": "sql_50",
    "question": "统计2024.10.1-2024.10.31期间点击400211，点击400212，点击400211及400212的重合用户作为用户类型，看不同性别、砺刃活跃度和乐园活跃度情况\n\n输出：用户类型（400211、400212、400211&400212、other），游戏角色性别（male、female、other）、乐园活跃度（light、medium、heavy、other）、砺刃活跃度（light、medium、heavy、other），人数\n\n乐园跟砺刃的活跃度： 轻度1-4天；中度5-15天；重度>=16天",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_matchlog_stat_di",
      "dws_jordass_login_di",
      "dwd_jordass_playerlogin_hi",
      "dws_jordass_buttonpress_pre_di"
    ],
    "knowledge": "性别根据时间开窗取最新一条",
    "sql": "WITH button_users AS (\n  SELECT \n    vplayerid,\n    MAX(CASE WHEN buttontype = '400211' THEN 1 ELSE 0 END) AS clicked_400211,\n    MAX(CASE WHEN buttontype = '400212' THEN 1 ELSE 0 END) AS clicked_400212\n  FROM dws_jordass_buttonpress_pre_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  AND buttontype IN ('400211', '400212')\n  GROUP BY vplayerid\n),\nuser_categories AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN clicked_400211 = 1 AND clicked_400212 = 1 THEN '400211&400212'\n      WHEN clicked_400211 = 1 THEN '400211'\n      WHEN clicked_400212 = 1 THEN '400212'\n      ELSE 'other'\n    END AS user_type\n  FROM button_users\n),\n-- Get latest gender for each user\nlatest_gender AS (\n  SELECT \n    vplayerid,\n    gender,\n    ROW_NUMBER() OVER (PARTITION BY vplayerid ORDER BY dteventtime DESC) as rn\n  FROM dwd_jordass_playerlogin_hi\n  WHERE gender IS NOT NULL\n),\nuser_gender AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN gender = 1 THEN 'male'\n      WHEN gender = 2 THEN 'female'\n      ELSE 'other'\n    END AS game_gender\n  FROM latest_gender\n  WHERE rn = 1\n),\n-- Calculate jordass activity level (login days in Oct 2024)\njordass_activity AS (\n  SELECT \n    vplayerid,\n    COUNT(DISTINCT dtstatdate) as login_days\n  FROM dws_jordass_login_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  GROUP BY vplayerid\n),\njordass_levels AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN login_days >= 16 THEN 'heavy'\n      WHEN login_days >= 5 THEN 'medium'\n      WHEN login_days >= 1 THEN 'light'\n      ELSE 'other'\n    END AS jordass_activity_level\n  FROM jordass_activity\n),\n-- Calculate park activity level (matchlog days in Oct 2024)\npark_activity AS (\n  SELECT \n    vplayerid,\n    COUNT(DISTINCT dtstatdate) as play_days\n  FROM dws_jordass_matchlog_stat_di\n  WHERE dtstatdate BETWEEN '20241001' AND '20241031'\n  GROUP BY vplayerid\n),\npark_levels AS (\n  SELECT \n    vplayerid,\n    CASE \n      WHEN play_days >= 16 THEN 'heavy'\n      WHEN play_days >= 5 THEN 'medium'\n      WHEN play_days >= 1 THEN 'light'\n      ELSE 'other'\n    END AS park_activity_level\n  FROM park_activity\n)\nSELECT \n  uc.user_type,\n  COALESCE(ug.game_gender, 'other') AS game_gender,\n  COALESCE(pl.park_activity_level, 'other') AS park_activity_level,\n  COALESCE(jl.jordass_activity_level, 'other') AS jordass_activity_level,\n  COUNT(*) AS user_count\nFROM user_categories uc\nLEFT JOIN user_gender ug ON uc.vplayerid = ug.vplayerid\nLEFT JOIN park_levels pl ON uc.vplayerid = pl.vplayerid\nLEFT JOIN jordass_levels jl ON uc.vplayerid = jl.vplayerid\nGROUP BY uc.user_type, ug.game_gender, pl.park_activity_level, jl.jordass_activity_level\nORDER BY uc.user_type, ug.game_gender, pl.park_activity_level, jl.jordass_activity_level"
  },
  {
    "sql_id": "sql_51",
    "question": "统计4个时间段灰度玩法参与情况\n\n时间段1：周期1：2024.11.08-11.21，周期2：2024.11.22-12.4\n时间段2：周期1：2024.11.10-11.23，周期2：2024.11.24-12.4\n时间段3：周期1：2024.11.15-11.28，周期2：2024.11.29-12.4\n时间段4：周期1：2024.11.17-11.30，周期2：2024.12.1-12.4\n输出：时间段（时间段1、时间段2、时间段3、时间段4），第1个周期进入过灰度玩法的用户数，两个周期都进入过灰度的用户数",
    "复杂度": "复杂",
    "table_list": [
      "dws_jordass_buttonpress_pre_di",
      "dim_jordass_submodeonlinedate_conf"
    ],
    "knowledge": "",
    "sql": "WITH 时间段统计 AS (\n  SELECT \n    '时间段1' as 时间段,\n    -- 第1个周期用户数\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di \n     WHERE dtstatdate BETWEEN '20241108' AND '20241121') as 第1个周期进入过灰度玩法的用户数,\n    -- 两个周期都进入过灰度的用户数\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di a\n     WHERE a.dtstatdate BETWEEN '20241108' AND '20241121'\n       AND EXISTS (\n         SELECT 1 \n         FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di b\n         WHERE b.vplayerid = a.vplayerid \n           AND b.dtstatdate BETWEEN '20241122' AND '20241204'\n       )) as 两个周期都进入过灰度的用户数\n\n  UNION ALL\n\n  SELECT \n    '时间段2' as 时间段,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di \n     WHERE dtstatdate BETWEEN '20241110' AND '20241123') as 第1个周期进入过灰度玩法的用户数,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di a\n     WHERE a.dtstatdate BETWEEN '20241110' AND '20241123'\n       AND EXISTS (\n         SELECT 1 \n         FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di b\n         WHERE b.vplayerid = a.vplayerid \n           AND b.dtstatdate BETWEEN '20241124' AND '20241204'\n       )) as 两个周期都进入过灰度的用户数\n\n  UNION ALL\n\n  SELECT \n    '时间段3' as 时间段,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di \n     WHERE dtstatdate BETWEEN '20241115' AND '20241128') as 第1个周期进入过灰度玩法的用户数,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di a\n     WHERE a.dtstatdate BETWEEN '20241115' AND '20241128'\n       AND EXISTS (\n         SELECT 1 \n         FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di b\n         WHERE b.vplayerid = a.vplayerid \n           AND b.dtstatdate BETWEEN '20241129' AND '20241204'\n       )) as 两个周期都进入过灰度的用户数\n\n  UNION ALL\n\n  SELECT \n    '时间段4' as 时间段,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di \n     WHERE dtstatdate BETWEEN '20241117' AND '20241130') as 第1个周期进入过灰度玩法的用户数,\n    (SELECT COUNT(DISTINCT vplayerid) \n     FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di a\n     WHERE a.dtstatdate BETWEEN '20241117' AND '20241130'\n       AND EXISTS (\n         SELECT 1 \n         FROM final_algorithm_competition.dws_jordass_buttonpress_pre_di b\n         WHERE b.vplayerid = a.vplayerid \n           AND b.dtstatdate BETWEEN '20241201' AND '20241204'\n       )) as 两个周期都进入过灰度的用户数\n)\n\nSELECT * FROM 时间段统计\nORDER BY 时间段"
  },
  {
    "sql_id": "sql_56",
    "question": "时间：2024.01.01-2024.01.31\n每日新增用户的LTV，LTV1~LTV10\n输出：注册日期(20240101、20240102、...、20240131)、新进用户数、LTV1、LTV3、LTV7、LTV14、LTV30、LTV60、LTV90、LTV180\n",
    "sql": "select\n    register_date,\n    count(distinct vplayerid) as new_user_cnt,\n    round(sum(case when datediff_pay < 1 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv1,\n    round(sum(case when datediff_pay < 3 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv3,\n    round(sum(case when datediff_pay < 7 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv7,\n    round(sum(case when datediff_pay < 14 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv14,\n    round(sum(case when datediff_pay < 30 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv30,\n    round(sum(case when datediff_pay < 60 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv60,\n    round(sum(case when datediff_pay < 90 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv90,\n    round(sum(case when datediff_pay < 180 then sum_pay_amount else 0 end) / count(distinct vplayerid), 2) as ltv180\nfrom (\n    select\n        s1.register_date,\n        s1.vplayerid,\n        s2.pay_date,\n        datediff(s2.pay_date, s1.register_date) as datediff_pay,\n        sum(s2.pay_amount) as sum_pay_amount\n    from (\n        select\n            distinct dregdate as register_date,\n            vplayerid\n        from dws_jordass_login_df\n        where dtstatdate = '20240131'\n          and platid = 255\n          and dregdate >= '20240101' and dregdate <= '20240131'\n    ) s1\n    left join (\n        select\n            dtstatdate as pay_date,\n            vplayerid,\n            sum(imoney/100) as pay_amount\n        from dws_jordass_water_di\n        where dtstatdate >= '20240101' and dtstatdate <= date_add('20240131', 179)\n          and platid = 255\n        group by dtstatdate, vplayerid\n    ) s2 on s1.vplayerid = s2.vplayerid\n    group by s1.register_date, s1.vplayerid, s2.pay_date\n) base\ngroup by register_date",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_water_di",
      "dws_jordass_login_df"
    ],
    "knowledge": "LTV（Life Time Value，用户生命周期价值）\n从注册日起，到第 N-1 天为止，这批新用户累计产生的总流水 ÷ 这批新用户的总人数。\n单位：元/人，衡量“每个新注册用户在 N 天内平均贡献了多少收入”。",
    "golden_sql": true
  },
  {
    "sql_id": "sql_57",
    "question": "统计限定抽取阶梯活动每天的pv和角色数\n活动日期\t2024.11.29-12.19\t\n输出：日期(20241129、...、20241219、汇总)、pv、uv",
    "sql": "-- 查询限定抽取阶梯活动相关数据\nselect\n    dtstatdate,\n    pv,\n    uv\nfrom (\n    -- 按天统计\n    select\n        substr(tdbank_imp_date, 1, 8) as dtstatdate,\n        count(*)                       as pv,\n        count(distinct uid)            as uv\n    from dwd_jordass_activitypress_hi\n    where tdbank_imp_date between '2024112900' and '2024121923'\n      and ireason   = 2411291018\n      and buttontype = 10045\n      and extarg1   in (117, 115)\n    group by substr(tdbank_imp_date, 1, 8)\n\n    union all\n\n    -- 汇总\n    select\n        '汇总' as dtstatdate,\n        count(*)            as pv,\n        count(distinct uid) as uv\n    from dwd_jordass_activitypress_hi\n    where tdbank_imp_date between '2024112900' and '2024121923'\n      and ireason   = 2411291018\n      and buttontype = 10045\n      and extarg1   in (117, 115)\n) f \n;\n",
    "复杂度": "简单",
    "table_list": [
      "dwd_jordass_activitypress_hi"
    ],
    "knowledge": "限定抽取阶梯活动：ireason = 2411291018 and buttontype = 10045 and  extarg1 in (117, 115)",
    "golden_sql": true
  },
  {
    "sql_id": "sql_59",
    "question": "统计：20250111-20250124时间区间内，幻境使者活动抽奖用户第X次触发赠送后，这些用户的总抽奖次数\n输出：第X次触发,触发用户数,用户总抽奖次数",
    "sql": "select \n    s1.trigger_count as `trigger_count`, -- 第x次触发\n    count(distinct s1.vplayerid) as `trigger_user_cnt`, -- 触发用户数\n    sum(s2.draw_count) as `total_draw_count` -- 用户总抽奖次数\nfrom (\n    select\n        vplayerid,\n        dteventtime,\n        coalesce(lead(dteventtime) over (partition by vplayerid order by dteventtime), '9999-12-31 23:59:59')  as next_dteventtime,\n        row_number() over (partition by vplayerid order by dteventtime) as trigger_count\n    from (\n        select distinct\n            vplayerid,\n            dteventtime\n        from dwd_jordass_activityrecord_hi\n        where tdbank_imp_date >= '2025011100'\n        and tdbank_imp_date <= '2025012423'\n        and actid = 2411070621\n        and acttype = 10062\n        and recodtype in ('1', '2')\n        and strarg1 <> '0'\n    ) ff1\n) s1 \njoin (\n    select\n        vplayerid,\n        dteventtime,\n        sum(arg1) as draw_count\n    from dwd_jordass_activityrecord_hi  -- actgeneralflow表\n    where tdbank_imp_date >= \"2025011100\" and tdbank_imp_date <= \"2025012423\" -- 时间区间：20250111-20250124\n    and actid = 2411070621\n    and acttype = 10062\n    and recodtype in (\"1\", \"2\")\n    group by vplayerid, dteventtime\n\n    \n) s2 \non s1.vplayerid = s2.vplayerid and s2. dteventtime >= s1.dteventtime and s2.dteventtime < s1.next_dteventtime\ngroup by s1.trigger_count\n\n",
    "复杂度": "复杂",
    "table_list": [
      "dwd_jordass_activityrecord_hi"
    ],
    "knowledge": "actid=2411070621 and acttype= 10062 表示幻境使者活动\narg1表示抽奖次数\nStrArg1<>0表示触发赠送",
    "golden_sql": true
  },
  {
    "sql_id": "sql_67",
    "question": "统计2025.1.24-2025.2.6时间区间内，道具为430487,430485,602004025,602002011 的产出次数\t\n输出：道具id，产出次数",
    "复杂度": "简单",
    "table_list": [
      "dwd_jordass_gearlog_hi"
    ],
    "knowledge": " addorreduce=0表示产出，1表示消耗",
    "sql": "SELECT \n    igoodsid AS 道具id,\n    COUNT(*) AS 产出次数\nFROM dwd_jordass_gearlog_hi\nWHERE \n    dteventtime >= '2025-01-24 00:00:00' \n    AND dteventtime <= '2025-02-06 23:59:59'\n    AND igoodsid IN (430487, 430485, 602004025, 602002011)\n    AND addorreduce = 0\nGROUP BY igoodsid\nORDER BY igoodsid;"
  },
  {
    "sql_id": "sql_69",
    "question": "统计2024.12.25——2025.1.5 ，不同信息类型的玩家数量\n\n信息类型:chattype in (20,25,26,16,27,8)\n\n输出 日期（20241225-20250105），信息类型，人数，次数",
    "复杂度": "简单",
    "table_list": [
      "dwd_jordass_msgchatrecord_hi"
    ],
    "knowledge": "chattype in (20,25,26,16,27,8)",
    "sql": "SELECT \n    LEFT(tdbank_imp_date, 8) AS 日期,\n    chattype AS 信息类型,\n    COUNT(DISTINCT playerid) AS 人数,\n    COUNT(*) AS 次数\nFROM dwd_jordass_msgchatrecord_hi\nWHERE \n    LEFT(tdbank_imp_date, 8) BETWEEN '20241225' AND '20250105'\n    AND chattype IN (20,25,26,16,27,8)\nGROUP BY \n    LEFT(tdbank_imp_date, 8), \n    chattype\nORDER BY \n    日期, \n    信息类型"
  },
  {
    "sql_id": "sql_70",
    "question": "统计2024.11.29-2024.12.19期间，不同抽奖档位的对应人数\n输出 抽奖档位（含汇总档位），人数",
    "复杂度": "简单",
    "table_list": [
      "dwd_jordass_activity_rewardrecord_hi"
    ],
    "knowledge": "抽奖活动：actid = 2411291018\n汇总：额外计算一个全档位统计组",
    "sql": "SELECT \n    CAST(awardidx AS CHAR) AS 抽奖档位,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM dwd_jordass_activity_rewardrecord_hi\nWHERE actid = 2411291018\nAND dteventtime >= '2024-11-29 00:00:00' \nAND dteventtime <= '2024-12-19 23:59:59'\nGROUP BY awardidx\nUNION ALL\nSELECT \n    '汇总' AS 抽奖档位,\n    COUNT(DISTINCT vplayerid) AS 人数\nFROM dwd_jordass_activity_rewardrecord_hi\nWHERE actid = 2411291018\nAND dteventtime >= '2024-11-29 00:00:00' \nAND dteventtime <= '2024-12-19 23:59:59'\nORDER BY 抽奖档位;"
  },
  {
    "sql_id": "sql_71",
    "question": "统计2024.11.29-2024.12.19期间，每七天统计一次阶梯活动相关用户数\n输出 日期范围（20241129-20241205、20241206-20241212、20241213-20241219），extarg1类型，用户数，次数",
    "复杂度": "简单",
    "table_list": [
      "dwd_jordass_activitypress_hi"
    ],
    "knowledge": "阶梯活动：ireason = 2411291018 and buttontype = 10045 and extarg1 in (101,109,110)",
    "sql": "SELECT \n    CASE \n        WHEN DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-05' THEN '20241129-20241205'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-06' AND '2024-12-12' THEN '20241206-20241212'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-13' AND '2024-12-19' THEN '20241213-20241219'\n    END AS date_range,\n    extarg1 AS extarg1_type,\n    COUNT(DISTINCT vplayerid) AS user_count,\n    COUNT(*) AS occurrence_count\nFROM dwd_jordass_activitypress_hi\nWHERE \n    DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-19'\n    AND ireason = 2411291018 \n    AND buttontype = 10045 \n    AND extarg1 IN (101, 109, 110)\nGROUP BY \n    CASE \n        WHEN DATE(dteventtime) BETWEEN '2024-11-29' AND '2024-12-05' THEN '20241129-20241205'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-06' AND '2024-12-12' THEN '20241206-20241212'\n        WHEN DATE(dteventtime) BETWEEN '2024-12-13' AND '2024-12-19' THEN '20241213-20241219'\n    END,\n    extarg1\nORDER BY \n    date_range,\n    extarg1_type;"
  },
  {
    "sql_id": "sql_73",
    "question": "统计20241123-20241222对决冠军，乐园其他，和乐园汇总 三类用户的组队和对局情况\n输出：乐园总参与人数，乐园总参与局数，乐园组队人数，乐园组队局数，对决冠军总参与人数，对决冠军总参与局数，对决冠军组队人数，对决冠军组队局数，乐园其他总参与人数，乐园其他总参与局数，乐园其他组队人数，乐园其他组队局数",
    "复杂度": "中等",
    "table_list": [
      "dwd_jordass_player_matchrecord_hi"
    ],
    "knowledge": "对决冠军：matchmode=1003 and matchsubmodegroup=1345785623905087744\n乐园其他：matchmode=1003 and matchsubmodegroup<>1345785623905087744\n乐园汇总：matchmode=1003\n都需要限制 matchresult=\"ok\"\n组队：teamnum>1",
    "sql": "SELECT \n    -- 乐园汇总 (matchmode=1003)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchresult = 'ok' THEN vplayerid END) AS 乐园总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchresult = 'ok' THEN 1 END) AS 乐园总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 乐园组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 乐园组队局数,\n    \n    -- 对决冠军 (matchmode=1003 and matchsubmodegroup=1345785623905087744)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' THEN vplayerid END) AS 对决冠军总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' THEN 1 END) AS 对决冠军总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 对决冠军组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup = 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 对决冠军组队局数,\n    \n    -- 乐园其他 (matchmode=1003 and matchsubmodegroup<>1345785623905087744)\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' THEN vplayerid END) AS 乐园其他总参与人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' THEN 1 END) AS 乐园其他总参与局数,\n    COUNT(DISTINCT CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN vplayerid END) AS 乐园其他组队人数,\n    COUNT(CASE WHEN matchmode = 1003 AND matchsubmodegroup != 1345785623905087744 AND matchresult = 'ok' AND teamnum > 1 THEN 1 END) AS 乐园其他组队局数\nFROM dwd_jordass_player_matchrecord_hi\nWHERE tdbank_imp_date BETWEEN 20241123 AND 20241222;"
  },
  {
    "sql_id": "sql_74",
    "question": "统计 SS30赛季手册和SS29赛季手册的按钮人数\nSS30赛季:2024112305 - 2024112616\nSS29赛季:2024092405 - 2024092716\n输出：按钮类型，SS30赛季手册人数，SS29赛季手册人数",
    "复杂度": "中等",
    "table_list": [
      "dwd_jordass_pressbutton_hi"
    ],
    "knowledge": "按钮：buttontypes等于411130或411200",
    "sql": "SELECT \n    buttontype as '按钮类型',\n    ss30_count as 'SS30赛季手册人数',\n    ss29_count as 'SS29赛季手册人数'\nFROM (\n    SELECT \n        '411130' as buttontype,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024112305' AND '2024112616' AND buttontypes LIKE '%411130%' THEN vplayerid END) as ss30_count,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024092405' AND '2024092716' AND buttontypes LIKE '%411130%' THEN vplayerid END) as ss29_count\n    FROM dwd_jordass_pressbutton_hi\n    WHERE (tdbank_imp_date BETWEEN '2024112305' AND '2024112616' OR tdbank_imp_date BETWEEN '2024092405' AND '2024092716')\n        AND buttontypes LIKE '%411130%'\n    UNION ALL\n    SELECT \n        '411200' as buttontype,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024112305' AND '2024112616' AND buttontypes LIKE '%411200%' THEN vplayerid END) as ss30_count,\n        COUNT(DISTINCT CASE WHEN tdbank_imp_date BETWEEN '2024092405' AND '2024092716' AND buttontypes LIKE '%411200%' THEN vplayerid END) as ss29_count\n    FROM dwd_jordass_pressbutton_hi\n    WHERE (tdbank_imp_date BETWEEN '2024112305' AND '2024112616' OR tdbank_imp_date BETWEEN '2024092405' AND '2024092716')\n        AND buttontypes LIKE '%411200%'\n) result"
  },
  {
    "sql_id": "sql_75",
    "question": "统计：2022080400-2024112400的研究所解锁语音数量\n输出：baseid,解锁语音数量",
    "复杂度": "中等",
    "table_list": [
      "dwd_jordass_voicethemelog_hi"
    ],
    "knowledge": "研究所：baseid in (3336008, 3304024, 3336012, 3306028, 3304030, 3336016, 3336018, 3304038, 3336023, 3306033, 3349004, 3308014, 3336032, 3304043, 3306039, 3336041, 3301024, 3336045, 3306042)",
    "sql": "SELECT \n    baseid,\n    COUNT(*) AS 解锁语音数量\nFROM \n    dwd_jordass_voicethemelog_hi\nWHERE \n    baseid IN (3336008, 3304024, 3336012, 3306028, 3304030, 3336016, 3336018, 3304038, 3336023, 3306033, 3349004, 3308014, 3336032, 3304043, 3306039, 3336041, 3301024, 3336045, 3306042)\n    AND dteventtime >= '2022-08-04 00:00:00'\n    AND dteventtime <= '2024-11-24 00:00:00'\nGROUP BY \n    baseid\nORDER BY \n    baseid;"
  },
  {
    "sql_id": "sql_78",
    "question": "统计：首日红装活动（20250119）返场抽奖的用户属性\n输出：初日华服回归抽奖&沙漠统治者有抽奖人数\n初日华服回归抽奖&境界双花有抽奖人数\t\t\n初日华服回归抽奖&玄龙凌霄有抽奖人数\t\t\n初日华服回归抽奖&沙漠统治者有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&境界双花有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&玄龙凌霄有抽奖&但没有其主套人数\t\t\n初日华服回归抽奖&【沙漠统治者和境界双花有主套】人数\t\t\n初日华服回归抽奖&【沙漠统治者和玄龙凌霄有主套】人数\t\t\t\t\n初日华服回归抽奖&【境界双花和玄龙凌霄有主套】人数\t\t\t\t\n初日华服回归抽奖但【沙漠统治者&境界双花&玄龙凌霄】没有抽奖人数",
    "复杂度": "复杂",
    "table_list": [
      "dwd_jordass_gearlog_hi",
      "dwd_jordass_lotteryrecord_hi"
    ],
    "knowledge": "抽奖活动时间：\n沙漠统治者：20240426-20240606 \n镜域双华：20240607-20240725 \n玄龙凌霄：20240726-20240822\n抽奖活动筛选条件：\n初日华服回归抽奖 activitytype = 815\n沙漠统治者有抽奖 activitytype = 690\n境界双花有抽奖 activitytype = 748\n玄龙凌霄有抽奖 activitytype = 750\n主套提取逻辑：\n提取道具沙漠统治者-有主套的用户 igoodsid = 430179 and addorreduce = 0\n提取道具镜域双华-有主套的用户 igoodsid = 430265  and addorreduce = 0\n提取道具玄龙凌霄-有主套用户 igoodsid = 430225  and addorreduce = 0",
    "sql": "WITH first_day_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE tdbank_imp_date LIKE '20250119%' AND activitytype = 815\n),\ndesert_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 690 AND tdbank_imp_date BETWEEN '20240426' AND '20240606'\n),\nrealm_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 748 AND tdbank_imp_date BETWEEN '20240607' AND '20240725'\n),\ndragon_draw_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_lotteryrecord_hi\n    WHERE activitytype = 750 AND tdbank_imp_date BETWEEN '20240726' AND '20240822'\n),\ndesert_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430179 AND addorreduce = 0\n),\nrealm_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430265 AND addorreduce = 0\n),\ndragon_owner_users AS (\n    SELECT DISTINCT vplayerid\n    FROM dwd_jordass_gearlog_hi\n    WHERE igoodsid = 430225 AND addorreduce = 0\n)\nSELECT \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_draw_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&沙漠统治者有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_draw_users r ON f.vplayerid = r.vplayerid) AS '初日华服回归抽奖&境界双花有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN dragon_draw_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&玄龙凌霄有抽奖人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN desert_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&沙漠统治者有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_draw_users r ON f.vplayerid = r.vplayerid\n     LEFT JOIN realm_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&境界双花有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN dragon_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN dragon_owner_users o ON f.vplayerid = o.vplayerid\n     WHERE o.vplayerid IS NULL) AS '初日华服回归抽奖&玄龙凌霄有抽奖&但没有其主套人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_owner_users d ON f.vplayerid = d.vplayerid\n     INNER JOIN realm_owner_users r ON f.vplayerid = r.vplayerid) AS '初日华服回归抽奖&【沙漠统治者和境界双花有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN desert_owner_users d ON f.vplayerid = d.vplayerid\n     INNER JOIN dragon_owner_users dr ON f.vplayerid = dr.vplayerid) AS '初日华服回归抽奖&【沙漠统治者和玄龙凌霄有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     INNER JOIN realm_owner_users r ON f.vplayerid = r.vplayerid\n     INNER JOIN dragon_owner_users d ON f.vplayerid = d.vplayerid) AS '初日华服回归抽奖&【境界双花和玄龙凌霄有主套】人数',\n     \n    (SELECT COUNT(DISTINCT f.vplayerid)\n     FROM first_day_users f\n     LEFT JOIN desert_draw_users d ON f.vplayerid = d.vplayerid\n     LEFT JOIN realm_draw_users r ON f.vplayerid = r.vplayerid\n     LEFT JOIN dragon_draw_users dr ON f.vplayerid = dr.vplayerid\n     WHERE d.vplayerid IS NULL AND r.vplayerid IS NULL AND dr.vplayerid IS NULL) AS '初日华服回归抽奖但【沙漠统治者&境界双花&玄龙凌霄】没有抽奖人数'"
  },
  {
    "sql_id": "sql_83",
    "question": "统计流失14天以上的回流用户的点击量子鸟赠礼、回到大厅和参与乐园对局的数据\n统计日期\n2024/1/2\n2023/12/19\n2023/12/12\n2023/12/5\n2023/10/10\n2023/9/19\n2023/1/3\n2022/12/20\n输出：统计日（YYYYMMDD）、用户类型（'流失14天以上的回流用户'）、当天回流用户数、点击量子鸟赠礼用户数、回到大厅用户数、当天有参与乐园对局的用户数",
    "复杂度": "复杂",
    "table_list": [
      "dws_jordass_matchlog_stat_di",
      "dws_jordass_login_df",
      "dws_jordass_buttonpress_pre_di"
    ],
    "knowledge": "点击量子鸟赠礼：buttontype =10370\n回到大厅：buttontype 10373或10374  \n流失14天以上的回流用户：统计日往前14天以上没有登陆游戏，在统计日登陆了游戏，比如统计日是2024-1-2，用户在2023-12-19到2024-1-1这14天连续没有登陆游戏，并且在2023-12-18及之前有登陆游戏，就是2024-1-2的流失14天以上的回流用户，其他统计日以此类推。",
    "sql": "WITH returning_users AS (\n  SELECT \n    dtstatdate,\n    vplayerid\n  FROM dws_jordass_login_df\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n    AND SUBSTRING(cbitmap, 1, 1) = '1'  -- Logged in on stat date\n    AND SUBSTRING(cbitmap, 2, 14) = REPEAT('0', 14)  -- No login for 14 days before\n    AND (LENGTH(cbitmap) > 15 OR (LENGTH(cbitmap) = 15 AND SUBSTRING(cbitmap, 15, 1) = '1'))\n),\nbutton_press_summary AS (\n  SELECT \n    dtstatdate,\n    vplayerid,\n    MAX(CASE WHEN buttontype = '10370' THEN 1 ELSE 0 END) AS quantum_bird_gift_click,\n    MAX(CASE WHEN buttontype IN ('10373', '10374') THEN 1 ELSE 0 END) AS return_to_lobby_click\n  FROM dws_jordass_buttonpress_pre_di\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n    AND buttontype IN ('10370', '10373', '10374')\n  GROUP BY dtstatdate, vplayerid\n),\npark_match_summary AS (\n  SELECT \n    dtstatdate,\n    vplayerid,\n    COUNT(*) AS park_match_count\n  FROM dws_jordass_matchlog_stat_di\n  WHERE dtstatdate IN (20240102, 20231219, 20231212, 20231205, 20231010, 20230919, 20230103, 20221220)\n  GROUP BY dtstatdate, vplayerid\n)\nSELECT \n  r.dtstatdate AS 统计日,\n  '流失14天以上的回流用户' AS 用户类型,\n  COUNT(r.vplayerid) AS 当天回流用户数,\n  COUNT(CASE WHEN b.quantum_bird_gift_click = 1 THEN 1 END) AS 点击量子鸟赠礼用户数,\n  COUNT(CASE WHEN b.return_to_lobby_click = 1 THEN 1 END) AS 回到大厅用户数,\n  COUNT(CASE WHEN p.park_match_count > 0 THEN 1 END) AS 当天有参与乐园对局的用户数\nFROM returning_users r\nLEFT JOIN button_press_summary b ON r.dtstatdate = b.dtstatdate AND r.vplayerid = b.vplayerid\nLEFT JOIN park_match_summary p ON r.dtstatdate = p.dtstatdate AND r.vplayerid = p.vplayerid\nGROUP BY r.dtstatdate\nORDER BY r.dtstatdate;"
  },
  {
    "sql_id": "sql_97",
    "question": "在2023.7.19-2023.7.25时间范围内，分别统计参与了隐匿的用户人数、既参与隐匿也参与了桥梁争夺的用户、既参与隐匿也参与了隐匿模式的用户\n输出：参与了隐匿的不重复的人的个数、参与隐匿并且参与了桥梁争夺的不重复的人的个数、参与隐匿并且参与了隐匿模式的不重复的人的个数\n",
    "复杂度": "中等",
    "table_list": [
      "dws_jordass_matchlog_stat_di",
      "dws_jordass_mode_roundrecord_di"
    ],
    "knowledge": "隐匿的用户：imode = 1307095884553538304  and platid <> 255\n桥梁争夺的用户：imode = 1310822585431254784  and platid <> 255\n隐匿模式的用户：mode=2370",
    "sql": "SELECT \n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS participated_in_stealth,\n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL AND bridge_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS stealth_and_bridge,\n    COUNT(DISTINCT CASE WHEN stealth_users.vplayerid IS NOT NULL AND stealth_mode_users.vplayerid IS NOT NULL THEN stealth_users.vplayerid END) AS stealth_and_stealth_mode\nFROM (\n    -- Users who participated in 隐匿 (imode = 1307095884553538304 and platid <> 255)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND imode = 1307095884553538304\n    AND platid <> 255\n) AS stealth_users\nLEFT JOIN (\n    -- Users who participated in 桥梁争夺 (imode = 1310822585431254784 and platid <> 255)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_matchlog_stat_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND imode = 1310822585431254784\n    AND platid <> 255\n) AS bridge_users ON stealth_users.vplayerid = bridge_users.vplayerid\nLEFT JOIN (\n    -- Users who participated in 隐匿模式 (mode = 2370)\n    SELECT DISTINCT vplayerid\n    FROM dws_jordass_mode_roundrecord_di\n    WHERE dtstatdate BETWEEN '20230719' AND '20230725'\n    AND mode = 2370\n) AS stealth_mode_users ON stealth_users.vplayerid = stealth_mode_users.vplayerid;"
  },
  {
    "sql_id": "sql_107",
    "question": "统计2022.1.18-1.24与2021.10.19-12.20这两个时间段\n buttontype =99123并且 ireason=3的人数，以及两个时间段都满足条件的交叉人数\n输出：2022.1.18-1.24人数，2021.10.19-12.20人数，两个时间段交叉的人数",
    "复杂度": "中等",
    "table_list": [
      "dwd_jordass_activitypress_hi"
    ],
    "knowledge": "",
    "sql": "SELECT \n    COUNT(DISTINCT CASE WHEN dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59' THEN vplayerid END) AS period1_count,\n    COUNT(DISTINCT CASE WHEN dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59' THEN vplayerid END) AS period2_count,\n    (SELECT COUNT(*) FROM (\n        SELECT vplayerid\n        FROM dwd_jordass_activitypress_hi\n        WHERE buttontype = 99123 AND ireason = 3\n        AND dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59'\n        INTERSECT\n        SELECT vplayerid\n        FROM dwd_jordass_activitypress_hi\n        WHERE buttontype = 99123 AND ireason = 3\n        AND dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59'\n    ) AS intersect_users) AS intersection_count\nFROM dwd_jordass_activitypress_hi\nWHERE buttontype = 99123 AND ireason = 3\nAND (\n    (dteventtime >= '2022-01-18 00:00:00' AND dteventtime <= '2022-01-24 23:59:59') OR\n    (dteventtime >= '2021-10-19 00:00:00' AND dteventtime <= '2021-12-20 23:59:59')\n);"
  }
]